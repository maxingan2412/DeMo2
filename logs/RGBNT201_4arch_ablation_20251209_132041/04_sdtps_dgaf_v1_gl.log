2025-12-09 13:20:45,031 DeMo INFO: Saving model in the path :..
2025-12-09 13:20:45,031 DeMo INFO: Namespace(config_file='configs/RGBNT201/DeMo_SDTPS_DGAF_ablation.yml', exp_name=None, fea_cft=0, local_rank=0, opts=['MODEL.USE_SDTPS', 'True', 'MODEL.USE_DGAF', 'True', 'MODEL.DGAF_VERSION', 'v1', 'MODEL.GLOBAL_LOCAL', 'True', 'MODEL.SDTPS_CROSS_ATTN_TYPE', 'attention', 'MODEL.SDTPS_CROSS_ATTN_HEADS', '4'])
2025-12-09 13:20:45,031 DeMo INFO: Loaded configuration file configs/RGBNT201/DeMo_SDTPS_DGAF_ablation.yml
2025-12-09 13:20:45,032 DeMo INFO: 
MODEL:
  TRANSFORMER_TYPE: 'ViT-B-16'
  STRIDE_SIZE: [ 16, 16 ]
  SIE_CAMERA: True
  DIRECT: 1
  SIE_COE: 1.0
  ID_LOSS_WEIGHT: 0.25
  TRIPLET_LOSS_WEIGHT: 1.0
  GLOBAL_LOCAL: False  # DGAF V3 直接用 tokens，不需要 GLOBAL_LOCAL
  # Disable HDM and ATM
  HDM: False
  ATM: False
  # SACR disabled for ablation
  USE_SACR: False
  USE_MULTIMODAL_SACR: False
  # LIF disabled
  USE_LIF: False
  # SDTPS configuration
  USE_SDTPS: True
  SDTPS_SPARSE_RATIO: 0.7  # token 保留比例（70%）
  SDTPS_USE_GUMBEL: False  # 禁用 Gumbel（训练稳定性）
  SDTPS_GUMBEL_TAU: 5.0
  SDTPS_CROSS_ATTN_TYPE: 'attention'  # 使用 Cross-Attention（推荐）
  SDTPS_CROSS_ATTN_HEADS: 4  # Cross-Attention 头数
  # 已废弃参数（保留兼容性）
  SDTPS_BETA: 0.25         # 已不使用（原 MLP predictor 权重）
  SDTPS_AGGR_RATIO: 0.5    # 已不使用（原 TokenAggregation）
  SDTPS_LOSS_WEIGHT: 2.0   # SDTPS 分支的损失权重
  # DGAF: Dual-Gated Adaptive Fusion
  USE_DGAF: True
  DGAF_VERSION: 'v3'  # V3 接受 (B,N,C) tokens
  DGAF_TAU: 1.0
  DGAF_INIT_ALPHA: 0.5
  DGAF_NUM_HEADS: 8
  HEAD: 4

INPUT:
  SIZE_TRAIN: [ 256, 128 ]
  SIZE_TEST: [ 256, 128 ]
  PROB: 0.5
  RE_PROB: 0.5
  PADDING: 10

DATALOADER:
  SAMPLER: 'softmax_triplet'
  NUM_INSTANCE: 8
  NUM_WORKERS: 14

DATASETS:
  NAMES: ('RGBNT201')
  ROOT_DIR: '..'

SOLVER:
  BASE_LR: 0.000005
  LR_SCHEDULER: 'linear'
  MAX_EPOCHS: 50
  STEPS: [30, 40]
  GAMMA: 0.1
  WARMUP_ITERS: 0
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: 'linear'
  OPTIMIZER_NAME: 'Adam'
  IMS_PER_BATCH: 64
  EVAL_PERIOD: 1
  CHECKPOINT_PERIOD: 10

TEST:
  IMS_PER_BATCH: 128
  RE_RANKING: 'no'
  WEIGHT: ''
  NECK_FEAT: 'before'
  FEAT_NORM: 'yes'
  MISS: "nothing"

OUTPUT_DIR: '..'

# ============================================================================
# SDTPS + DGAF Ablation Config
# ============================================================================
# - SACR: disabled
# - SDTPS: configurable via command line
# - DGAF V3: configurable via command line
# - Training: lr=0.00035, epochs=50, warmup=10
# - TF32: enabled in train_net.py
# ============================================================================

2025-12-09 13:20:45,032 DeMo INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 8
  NUM_WORKERS: 14
  SAMPLER: softmax_triplet
DATASETS:
  NAMES: RGBNT201
  ROOT_DIR: ..
INPUT:
  PADDING: 10
  PIXEL_MEAN: [0.5, 0.5, 0.5]
  PIXEL_STD: [0.5, 0.5, 0.5]
  PROB: 0.5
  RE_PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
MODEL:
  ADAPTER: False
  ATM: False
  ATT_DROP_RATE: 0.0
  DEVICE: cuda
  DEVICE_ID: 0
  DGAF_INIT_ALPHA: 0.5
  DGAF_NUM_HEADS: 8
  DGAF_TAU: 1.0
  DGAF_VERSION: v1
  DIRECT: 1
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FROZEN: False
  GLOBAL_LOCAL: True
  HDM: False
  HEAD: 4
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 0.25
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LIF_BETA: 0.4
  LIF_LAYER: 3
  LIF_LOSS_WEIGHT: 0.1
  METRIC_LOSS_TYPE: triplet
  MULTIMODAL_SACR_VERSION: v1
  NAME: DeMo
  NECK: bnneck
  NO_MARGIN: True
  PRETRAIN_PATH_T: /path/to/your/vitb_16_224_21k.pth
  PROMPT: False
  SACR_DILATION_RATES: [2, 3, 4]
  SDTPS_AGGR_RATIO: 0.5
  SDTPS_BETA: 0.25
  SDTPS_CROSS_ATTN_HEADS: 4
  SDTPS_CROSS_ATTN_TYPE: attention
  SDTPS_GUMBEL_TAU: 5.0
  SDTPS_LOSS_WEIGHT: 2.0
  SDTPS_SPARSE_RATIO: 0.7
  SDTPS_USE_GUMBEL: False
  SIE_CAMERA: True
  SIE_COE: 1.0
  SIE_VIEW: False
  STRIDE_SIZE: [16, 16]
  TRANSFORMER_TYPE: ViT-B-16
  TRIPLET_LOSS_WEIGHT: 1.0
  USE_DGAF: True
  USE_LIF: False
  USE_MULTIMODAL_SACR: False
  USE_SACR: False
  USE_SDTPS: True
OUTPUT_DIR: ..
SOLVER:
  BASE_LR: 5e-06
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.1
  IMS_PER_BATCH: 64
  LARGE_FC_LR: False
  LOG_PERIOD: 10
  LR_SCHEDULER: linear
  MARGIN: 0.3
  MAX_EPOCHS: 50
  MOMENTUM: 0.9
  OPTIMIZER_NAME: Adam
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (30, 40)
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 0
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
TEST:
  FEAT: 0
  FEAT_NORM: yes
  IMS_PER_BATCH: 128
  MISS: nothing
  NECK_FEAT: before
  RE_RANKING: no
  WEIGHT: 
=> RGBNT201 loaded
Dataset statistics:
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train    |   171 |     3951 |         4
  query    |    30 |      836 |         2
  gallery  |    30 |      836 |         2
  ----------------------------------------
data is ready
using Transformer_type: ViT-B-16 as a backbone
Resized position embedding: %s to %s torch.Size([197, 768]) torch.Size([129, 768])
Position embedding resize to height:16 width: 8
Successfully load ckpt!
<All keys matched successfully>
Loading pretrained model from CLIP
camera number is : 4
===========Building DeMo===========
2025-12-09 13:20:56,504 DeMo INFO: DeMo(
  (BACKBONE): build_transformer(
    (base): VisionTransformer(
      (conv1): Conv2d(3, 768, kernel_size=(16, 16), stride=(16, 16), bias=False)
      (ln_pre): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
      (transformer): Transformer(
        (resblocks): Sequential(
          (0): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (1): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (2): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (3): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (4): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (5): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (6): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (7): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (8): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (9): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (10): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (11): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
        )
      )
      (ln_post): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
    )
  )
  (pool): AdaptiveAvgPool1d(output_size=1)
  (rgb_reduce): Sequential(
    (0): LayerNorm((1024,), eps=1e-05, elementwise_affine=True)
    (1): Linear(in_features=1024, out_features=512, bias=True)
    (2): QuickGELU()
  )
  (nir_reduce): Sequential(
    (0): LayerNorm((1024,), eps=1e-05, elementwise_affine=True)
    (1): Linear(in_features=1024, out_features=512, bias=True)
    (2): QuickGELU()
  )
  (tir_reduce): Sequential(
    (0): LayerNorm((1024,), eps=1e-05, elementwise_affine=True)
    (1): Linear(in_features=1024, out_features=512, bias=True)
    (2): QuickGELU()
  )
  (dgaf): DualGatedPostFusion(
    (entropy_proj): Linear(in_features=512, out_features=512, bias=True)
    (gate_net): Sequential(
      (0): Linear(in_features=1536, out_features=512, bias=True)
      (1): LayerNorm((512,), eps=1e-05, elementwise_affine=True)
      (2): ReLU(inplace=True)
      (3): Linear(in_features=512, out_features=3, bias=True)
      (4): Sigmoid()
    )
    (modal_enhance): Sequential(
      (0): Linear(in_features=512, out_features=512, bias=True)
      (1): LayerNorm((512,), eps=1e-05, elementwise_affine=True)
    )
  )
  (sdtps): MultiModalSDTPS(
    (rgb_sparse): TokenSparse()
    (nir_sparse): TokenSparse()
    (tir_sparse): TokenSparse()
    (rgb_self_attn): CrossModalAttention(
      (q_proj): Linear(in_features=512, out_features=512, bias=True)
      (k_proj): Linear(in_features=512, out_features=512, bias=True)
      (attn_drop): Dropout(p=0.0, inplace=False)
    )
    (rgb_cross_nir): CrossModalAttention(
      (q_proj): Linear(in_features=512, out_features=512, bias=True)
      (k_proj): Linear(in_features=512, out_features=512, bias=True)
      (attn_drop): Dropout(p=0.0, inplace=False)
    )
    (rgb_cross_tir): CrossModalAttention(
      (q_proj): Linear(in_features=512, out_features=512, bias=True)
      (k_proj): Linear(in_features=512, out_features=512, bias=True)
      (attn_drop): Dropout(p=0.0, inplace=False)
    )
    (nir_self_attn): CrossModalAttention(
      (q_proj): Linear(in_features=512, out_features=512, bias=True)
      (k_proj): Linear(in_features=512, out_features=512, bias=True)
      (attn_drop): Dropout(p=0.0, inplace=False)
    )
    (nir_cross_rgb): CrossModalAttention(
      (q_proj): Linear(in_features=512, out_features=512, bias=True)
      (k_proj): Linear(in_features=512, out_features=512, bias=True)
      (attn_drop): Dropout(p=0.0, inplace=False)
    )
    (nir_cross_tir): CrossModalAttention(
      (q_proj): Linear(in_features=512, out_features=512, bias=True)
      (k_proj): Linear(in_features=512, out_features=512, bias=True)
      (attn_drop): Dropout(p=0.0, inplace=False)
    )
    (tir_self_attn): CrossModalAttention(
      (q_proj): Linear(in_features=512, out_features=512, bias=True)
      (k_proj): Linear(in_features=512, out_features=512, bias=True)
      (attn_drop): Dropout(p=0.0, inplace=False)
    )
    (tir_cross_rgb): CrossModalAttention(
      (q_proj): Linear(in_features=512, out_features=512, bias=True)
      (k_proj): Linear(in_features=512, out_features=512, bias=True)
      (attn_drop): Dropout(p=0.0, inplace=False)
    )
    (tir_cross_nir): CrossModalAttention(
      (q_proj): Linear(in_features=512, out_features=512, bias=True)
      (k_proj): Linear(in_features=512, out_features=512, bias=True)
      (attn_drop): Dropout(p=0.0, inplace=False)
    )
  )
  (classifier_sdtps): Linear(in_features=1536, out_features=171, bias=False)
  (bottleneck_sdtps): BatchNorm1d(1536, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
  (classifier_dgaf): Linear(in_features=1536, out_features=171, bias=False)
  (bottleneck_dgaf): BatchNorm1d(1536, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
  (classifier): Linear(in_features=1536, out_features=171, bias=False)
  (bottleneck): BatchNorm1d(1536, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
)
2025-12-09 13:20:56,505 DeMo INFO: number of parameters:94.560341
/home/yij/miniconda3/envs/DeMo/lib/python3.8/site-packages/timm/models/helpers.py:7: FutureWarning: Importing from timm.models.helpers is deprecated, please import via timm.models
  warnings.warn(f"Importing from {__name__} is deprecated, please import via timm.models", FutureWarning)
/home/yij/miniconda3/envs/DeMo/lib/python3.8/site-packages/timm/models/registry.py:4: FutureWarning: Importing from timm.models.registry is deprecated, please import via timm.models
  warnings.warn(f"Importing from {__name__} is deprecated, please import via timm.models", FutureWarning)
/home/yij/miniconda3/envs/DeMo/lib/python3.8/site-packages/timm/models/layers/__init__.py:48: FutureWarning: Importing from timm.models.layers is deprecated, please import via timm.layers
  warnings.warn(f"Importing from {__name__} is deprecated, please import via timm.layers", FutureWarning)
/raid/yij/icme/demo2new/DeMo2/modeling/clip/clip.py:23: UserWarning: PyTorch version 1.7.1 or higher is recommended
  warnings.warn("PyTorch version 1.7.1 or higher is recommended")
/home/yij/miniconda3/envs/DeMo/lib/python3.8/site-packages/torchvision/transforms/transforms.py:329: UserWarning: Argument 'interpolation' of type int is deprecated since 0.13 and will be removed in 0.15. Please use InterpolationMode enum.
  warnings.warn(
Unsupported operator aten::log encountered 3 time(s)
The following submodules of the model were never called during the trace of the graph. They may be unused, or they were accessed by direct calls to .forward() or via other python methods. In the latter case they will have zeros for statistics, though their statistics will still contribute to their parent calling module.
BACKBONE.base.transformer.resblocks.0.attn.out_proj, BACKBONE.base.transformer.resblocks.1.attn.out_proj, BACKBONE.base.transformer.resblocks.10.attn.out_proj, BACKBONE.base.transformer.resblocks.11.attn.out_proj, BACKBONE.base.transformer.resblocks.2.attn.out_proj, BACKBONE.base.transformer.resblocks.3.attn.out_proj, BACKBONE.base.transformer.resblocks.4.attn.out_proj, BACKBONE.base.transformer.resblocks.5.attn.out_proj, BACKBONE.base.transformer.resblocks.6.attn.out_proj, BACKBONE.base.transformer.resblocks.7.attn.out_proj, BACKBONE.base.transformer.resblocks.8.attn.out_proj, BACKBONE.base.transformer.resblocks.9.attn.out_proj, bottleneck, bottleneck_dgaf, bottleneck_sdtps, classifier, classifier_dgaf, classifier_sdtps
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The out_proj here is called by the nn.MultiheadAttention, which has been calculated in th .forward(), so just ignore it.
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
For the bottleneck or classifier, it is not calculated during inference, so just ignore it.
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:20:59,640 DeMo INFO: number of GFLOPs: 34.58600013399999
using soft triplet loss for training
label smooth on, numclasses: 171
2025-12-09 13:20:59,656 DeMo.train INFO: start training
/home/yij/miniconda3/envs/DeMo/lib/python3.8/site-packages/torch/optim/lr_scheduler.py:138: UserWarning: Detected call of `lr_scheduler.step()` before `optimizer.step()`. In PyTorch 1.1.0 and later, you should call them in the opposite order: `optimizer.step()` before `lr_scheduler.step()`.  Failure to do this will result in PyTorch skipping the first value of the learning rate schedule. See more details at https://pytorch.org/docs/stable/optim.html#how-to-adjust-learning-rate
  warnings.warn("Detected call of `lr_scheduler.step()` before `optimizer.step()`. "
/home/yij/miniconda3/envs/DeMo/lib/python3.8/site-packages/torch/optim/lr_scheduler.py:163: UserWarning: The epoch parameter in `scheduler.step()` was not necessary and is being deprecated where possible. Please use `scheduler.step()` to step the scheduler. During the deprecation, if epoch is different from None, the closed form is used instead of the new chainable form, where available. Please open an issue if you are unable to replicate your use case: https://github.com/pytorch/pytorch/issues/new/choose.
  warnings.warn(EPOCH_DEPRECATION_WARNING, UserWarning)
2025-12-09 13:21:04,443 DeMo.train INFO: Epoch[1] Iteration[10/54] Loss: 11.735, Acc: 0.009, Base Lr: 5.00e-06
2025-12-09 13:21:07,339 DeMo.train INFO: Epoch[1] Iteration[20/54] Loss: 9.457, Acc: 0.008, Base Lr: 5.00e-06
2025-12-09 13:21:09,847 DeMo.train INFO: Epoch[1] Iteration[30/54] Loss: 8.466, Acc: 0.008, Base Lr: 5.00e-06
2025-12-09 13:21:12,356 DeMo.train INFO: Epoch[1] Iteration[40/54] Loss: 7.895, Acc: 0.010, Base Lr: 5.00e-06
2025-12-09 13:21:14,866 DeMo.train INFO: Epoch[1] Iteration[50/54] Loss: 7.532, Acc: 0.011, Base Lr: 5.00e-06
2025-12-09 13:21:15,798 DeMo.train INFO: Epoch 1 done. Time per batch: 0.304[s] Speed: 210.2[samples/s]
2025-12-09 13:21:15,800 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:21:15,800 DeMo.train INFO: Current is the ori feature testing!
2025-12-09 13:21:15,800 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-09 13:21:22,106 DeMo.train INFO: Validation Results - Epoch: 1
2025-12-09 13:21:22,108 DeMo.train INFO: mAP: 12.8%
2025-12-09 13:21:22,109 DeMo.train INFO: CMC curve, Rank-1  :9.7%
2025-12-09 13:21:22,109 DeMo.train INFO: CMC curve, Rank-5  :24.6%
2025-12-09 13:21:22,110 DeMo.train INFO: CMC curve, Rank-10 :35.2%
2025-12-09 13:21:22,111 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:21:22,115 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:21:22,115 DeMo.train INFO: Current is the moe feature testing!
2025-12-09 13:21:22,116 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-09 13:21:31,283 DeMo.train INFO: Validation Results - Epoch: 1
2025-12-09 13:21:31,285 DeMo.train INFO: mAP: 12.8%
2025-12-09 13:21:31,286 DeMo.train INFO: CMC curve, Rank-1  :9.7%
2025-12-09 13:21:31,288 DeMo.train INFO: CMC curve, Rank-5  :24.6%
2025-12-09 13:21:31,289 DeMo.train INFO: CMC curve, Rank-10 :35.2%
2025-12-09 13:21:31,289 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:21:31,293 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:21:31,294 DeMo.train INFO: Current is the [moe,ori] feature testing!
2025-12-09 13:21:31,295 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-09 13:21:40,706 DeMo.train INFO: Validation Results - Epoch: 1
2025-12-09 13:21:40,707 DeMo.train INFO: mAP: 12.8%
2025-12-09 13:21:40,707 DeMo.train INFO: CMC curve, Rank-1  :9.7%
2025-12-09 13:21:40,709 DeMo.train INFO: CMC curve, Rank-5  :24.6%
2025-12-09 13:21:40,710 DeMo.train INFO: CMC curve, Rank-10 :35.2%
2025-12-09 13:21:40,710 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:22:30,032 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:22:30,032 DeMo.train INFO: Best mAP: 12.8%
2025-12-09 13:22:30,032 DeMo.train INFO: Best Rank-1: 9.7%
2025-12-09 13:22:30,033 DeMo.train INFO: Best Rank-5: 24.6%
2025-12-09 13:22:30,033 DeMo.train INFO: Best Rank-10: 35.2%
2025-12-09 13:22:30,033 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:22:34,357 DeMo.train INFO: Epoch[2] Iteration[10/54] Loss: 5.834, Acc: 0.031, Base Lr: 5.00e-06
2025-12-09 13:22:36,948 DeMo.train INFO: Epoch[2] Iteration[20/54] Loss: 5.768, Acc: 0.039, Base Lr: 5.00e-06
2025-12-09 13:22:39,484 DeMo.train INFO: Epoch[2] Iteration[30/54] Loss: 5.705, Acc: 0.061, Base Lr: 5.00e-06
2025-12-09 13:22:42,018 DeMo.train INFO: Epoch[2] Iteration[40/54] Loss: 5.669, Acc: 0.065, Base Lr: 5.00e-06
2025-12-09 13:22:44,546 DeMo.train INFO: Epoch[2] Iteration[50/54] Loss: 5.589, Acc: 0.068, Base Lr: 5.00e-06
2025-12-09 13:22:45,428 DeMo.train INFO: Epoch 2 done. Time per batch: 0.290[s] Speed: 220.3[samples/s]
2025-12-09 13:22:45,431 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:22:45,432 DeMo.train INFO: Current is the ori feature testing!
2025-12-09 13:22:45,434 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-09 13:22:54,614 DeMo.train INFO: Validation Results - Epoch: 2
2025-12-09 13:22:54,615 DeMo.train INFO: mAP: 37.3%
2025-12-09 13:22:54,616 DeMo.train INFO: CMC curve, Rank-1  :36.2%
2025-12-09 13:22:54,618 DeMo.train INFO: CMC curve, Rank-5  :53.9%
2025-12-09 13:22:54,619 DeMo.train INFO: CMC curve, Rank-10 :65.0%
2025-12-09 13:22:54,619 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:22:55,764 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:22:55,765 DeMo.train INFO: Current is the moe feature testing!
2025-12-09 13:22:55,765 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-09 13:23:13,385 DeMo.train INFO: Validation Results - Epoch: 2
2025-12-09 13:23:13,385 DeMo.train INFO: mAP: 37.3%
2025-12-09 13:23:13,385 DeMo.train INFO: CMC curve, Rank-1  :36.2%
2025-12-09 13:23:13,386 DeMo.train INFO: CMC curve, Rank-5  :53.9%
2025-12-09 13:23:13,386 DeMo.train INFO: CMC curve, Rank-10 :65.0%
2025-12-09 13:23:13,386 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:23:13,403 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:23:13,403 DeMo.train INFO: Current is the [moe,ori] feature testing!
2025-12-09 13:23:13,403 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-09 13:23:18,891 DeMo.train INFO: Validation Results - Epoch: 2
2025-12-09 13:23:18,893 DeMo.train INFO: mAP: 37.3%
2025-12-09 13:23:18,894 DeMo.train INFO: CMC curve, Rank-1  :36.2%
2025-12-09 13:23:18,894 DeMo.train INFO: CMC curve, Rank-5  :53.9%
2025-12-09 13:23:18,895 DeMo.train INFO: CMC curve, Rank-10 :65.0%
2025-12-09 13:23:18,896 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:24:06,725 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:24:06,726 DeMo.train INFO: Best mAP: 37.3%
2025-12-09 13:24:06,726 DeMo.train INFO: Best Rank-1: 36.2%
2025-12-09 13:24:06,727 DeMo.train INFO: Best Rank-5: 53.9%
2025-12-09 13:24:06,727 DeMo.train INFO: Best Rank-10: 65.0%
2025-12-09 13:24:06,728 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:24:16,754 DeMo.train INFO: Epoch[3] Iteration[10/54] Loss: 5.057, Acc: 0.136, Base Lr: 5.00e-06
2025-12-09 13:24:22,403 DeMo.train INFO: Epoch[3] Iteration[20/54] Loss: 5.020, Acc: 0.145, Base Lr: 5.00e-06
2025-12-09 13:24:27,353 DeMo.train INFO: Epoch[3] Iteration[30/54] Loss: 4.925, Acc: 0.163, Base Lr: 5.00e-06
2025-12-09 13:24:29,926 DeMo.train INFO: Epoch[3] Iteration[40/54] Loss: 4.890, Acc: 0.160, Base Lr: 5.00e-06
2025-12-09 13:24:32,478 DeMo.train INFO: Epoch[3] Iteration[50/54] Loss: 4.804, Acc: 0.163, Base Lr: 5.00e-06
2025-12-09 13:24:33,370 DeMo.train INFO: Epoch 3 done. Time per batch: 0.503[s] Speed: 127.3[samples/s]
2025-12-09 13:24:33,374 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:24:33,374 DeMo.train INFO: Current is the ori feature testing!
2025-12-09 13:24:33,374 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-09 13:24:38,340 DeMo.train INFO: Validation Results - Epoch: 3
2025-12-09 13:24:38,340 DeMo.train INFO: mAP: 47.4%
2025-12-09 13:24:38,341 DeMo.train INFO: CMC curve, Rank-1  :47.0%
2025-12-09 13:24:38,341 DeMo.train INFO: CMC curve, Rank-5  :65.0%
2025-12-09 13:24:38,341 DeMo.train INFO: CMC curve, Rank-10 :71.9%
2025-12-09 13:24:38,341 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:24:38,969 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:24:38,969 DeMo.train INFO: Current is the moe feature testing!
2025-12-09 13:24:38,970 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-09 13:24:44,709 DeMo.train INFO: Validation Results - Epoch: 3
2025-12-09 13:24:44,709 DeMo.train INFO: mAP: 47.4%
2025-12-09 13:24:44,710 DeMo.train INFO: CMC curve, Rank-1  :47.0%
2025-12-09 13:24:44,710 DeMo.train INFO: CMC curve, Rank-5  :65.0%
2025-12-09 13:24:44,710 DeMo.train INFO: CMC curve, Rank-10 :71.9%
2025-12-09 13:24:44,710 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:24:45,861 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:24:45,861 DeMo.train INFO: Current is the [moe,ori] feature testing!
2025-12-09 13:24:45,861 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-09 13:24:56,216 DeMo.train INFO: Validation Results - Epoch: 3
2025-12-09 13:24:56,216 DeMo.train INFO: mAP: 47.4%
2025-12-09 13:24:56,217 DeMo.train INFO: CMC curve, Rank-1  :47.0%
2025-12-09 13:24:56,219 DeMo.train INFO: CMC curve, Rank-5  :65.0%
2025-12-09 13:24:56,219 DeMo.train INFO: CMC curve, Rank-10 :71.9%
2025-12-09 13:24:56,220 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:25:53,801 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:25:53,803 DeMo.train INFO: Best mAP: 47.4%
2025-12-09 13:25:53,803 DeMo.train INFO: Best Rank-1: 47.0%
2025-12-09 13:25:53,804 DeMo.train INFO: Best Rank-5: 65.0%
2025-12-09 13:25:53,804 DeMo.train INFO: Best Rank-10: 71.9%
2025-12-09 13:25:53,804 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:25:59,075 DeMo.train INFO: Epoch[4] Iteration[10/54] Loss: 4.562, Acc: 0.319, Base Lr: 5.00e-06
2025-12-09 13:26:01,649 DeMo.train INFO: Epoch[4] Iteration[20/54] Loss: 4.393, Acc: 0.297, Base Lr: 5.00e-06
2025-12-09 13:26:04,163 DeMo.train INFO: Epoch[4] Iteration[30/54] Loss: 4.379, Acc: 0.278, Base Lr: 5.00e-06
2025-12-09 13:26:06,691 DeMo.train INFO: Epoch[4] Iteration[40/54] Loss: 4.343, Acc: 0.278, Base Lr: 5.00e-06
2025-12-09 13:26:09,231 DeMo.train INFO: Epoch[4] Iteration[50/54] Loss: 4.310, Acc: 0.285, Base Lr: 5.00e-06
2025-12-09 13:26:10,114 DeMo.train INFO: Epoch 4 done. Time per batch: 0.308[s] Speed: 208.0[samples/s]
2025-12-09 13:26:10,115 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:26:10,117 DeMo.train INFO: Current is the ori feature testing!
2025-12-09 13:26:10,118 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-09 13:26:19,478 DeMo.train INFO: Validation Results - Epoch: 4
2025-12-09 13:26:19,479 DeMo.train INFO: mAP: 53.4%
2025-12-09 13:26:19,479 DeMo.train INFO: CMC curve, Rank-1  :55.3%
2025-12-09 13:26:19,480 DeMo.train INFO: CMC curve, Rank-5  :66.9%
2025-12-09 13:26:19,482 DeMo.train INFO: CMC curve, Rank-10 :73.8%
2025-12-09 13:26:19,482 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:26:20,585 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:26:20,586 DeMo.train INFO: Current is the moe feature testing!
2025-12-09 13:26:20,587 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-09 13:26:38,082 DeMo.train INFO: Validation Results - Epoch: 4
2025-12-09 13:26:38,084 DeMo.train INFO: mAP: 53.4%
2025-12-09 13:26:38,085 DeMo.train INFO: CMC curve, Rank-1  :55.3%
2025-12-09 13:26:38,086 DeMo.train INFO: CMC curve, Rank-5  :66.9%
2025-12-09 13:26:38,086 DeMo.train INFO: CMC curve, Rank-10 :73.8%
2025-12-09 13:26:38,087 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:26:38,097 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:26:38,098 DeMo.train INFO: Current is the [moe,ori] feature testing!
2025-12-09 13:26:38,099 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-09 13:26:43,348 DeMo.train INFO: Validation Results - Epoch: 4
2025-12-09 13:26:43,349 DeMo.train INFO: mAP: 53.4%
2025-12-09 13:26:43,350 DeMo.train INFO: CMC curve, Rank-1  :55.3%
2025-12-09 13:26:43,351 DeMo.train INFO: CMC curve, Rank-5  :66.9%
2025-12-09 13:26:43,352 DeMo.train INFO: CMC curve, Rank-10 :73.8%
2025-12-09 13:26:43,352 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:27:41,246 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:27:41,248 DeMo.train INFO: Best mAP: 53.4%
2025-12-09 13:27:41,249 DeMo.train INFO: Best Rank-1: 55.3%
2025-12-09 13:27:41,250 DeMo.train INFO: Best Rank-5: 66.9%
2025-12-09 13:27:41,250 DeMo.train INFO: Best Rank-10: 73.8%
2025-12-09 13:27:41,251 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:27:51,203 DeMo.train INFO: Epoch[5] Iteration[10/54] Loss: 4.141, Acc: 0.405, Base Lr: 5.00e-06
2025-12-09 13:27:54,154 DeMo.train INFO: Epoch[5] Iteration[20/54] Loss: 4.239, Acc: 0.455, Base Lr: 5.00e-06
2025-12-09 13:27:56,697 DeMo.train INFO: Epoch[5] Iteration[30/54] Loss: 4.206, Acc: 0.468, Base Lr: 5.00e-06
2025-12-09 13:27:59,275 DeMo.train INFO: Epoch[5] Iteration[40/54] Loss: 4.183, Acc: 0.468, Base Lr: 5.00e-06
2025-12-09 13:28:01,791 DeMo.train INFO: Epoch[5] Iteration[50/54] Loss: 4.160, Acc: 0.475, Base Lr: 5.00e-06
2025-12-09 13:28:02,673 DeMo.train INFO: Epoch 5 done. Time per batch: 0.404[s] Speed: 158.4[samples/s]
2025-12-09 13:28:02,675 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:28:02,675 DeMo.train INFO: Current is the ori feature testing!
2025-12-09 13:28:02,675 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-09 13:28:07,722 DeMo.train INFO: Validation Results - Epoch: 5
2025-12-09 13:28:07,722 DeMo.train INFO: mAP: 61.3%
2025-12-09 13:28:07,722 DeMo.train INFO: CMC curve, Rank-1  :63.5%
2025-12-09 13:28:07,722 DeMo.train INFO: CMC curve, Rank-5  :76.6%
2025-12-09 13:28:07,723 DeMo.train INFO: CMC curve, Rank-10 :82.3%
2025-12-09 13:28:07,723 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:28:08,185 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:28:08,185 DeMo.train INFO: Current is the moe feature testing!
2025-12-09 13:28:08,185 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-09 13:28:16,482 DeMo.train INFO: Validation Results - Epoch: 5
2025-12-09 13:28:16,483 DeMo.train INFO: mAP: 61.3%
2025-12-09 13:28:16,484 DeMo.train INFO: CMC curve, Rank-1  :63.5%
2025-12-09 13:28:16,485 DeMo.train INFO: CMC curve, Rank-5  :76.6%
2025-12-09 13:28:16,486 DeMo.train INFO: CMC curve, Rank-10 :82.3%
2025-12-09 13:28:16,486 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:28:17,336 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:28:17,338 DeMo.train INFO: Current is the [moe,ori] feature testing!
2025-12-09 13:28:17,338 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-09 13:28:27,731 DeMo.train INFO: Validation Results - Epoch: 5
2025-12-09 13:28:27,733 DeMo.train INFO: mAP: 61.3%
2025-12-09 13:28:27,734 DeMo.train INFO: CMC curve, Rank-1  :63.5%
2025-12-09 13:28:27,735 DeMo.train INFO: CMC curve, Rank-5  :76.6%
2025-12-09 13:28:27,736 DeMo.train INFO: CMC curve, Rank-10 :82.3%
2025-12-09 13:28:27,737 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:29:17,317 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:29:17,318 DeMo.train INFO: Best mAP: 61.3%
2025-12-09 13:29:17,319 DeMo.train INFO: Best Rank-1: 63.5%
2025-12-09 13:29:17,319 DeMo.train INFO: Best Rank-5: 76.6%
2025-12-09 13:29:17,319 DeMo.train INFO: Best Rank-10: 82.3%
2025-12-09 13:29:17,319 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:29:21,389 DeMo.train INFO: Epoch[6] Iteration[10/54] Loss: 3.951, Acc: 0.597, Base Lr: 5.00e-06
2025-12-09 13:29:24,794 DeMo.train INFO: Epoch[6] Iteration[20/54] Loss: 3.958, Acc: 0.590, Base Lr: 5.00e-06
2025-12-09 13:29:27,330 DeMo.train INFO: Epoch[6] Iteration[30/54] Loss: 3.967, Acc: 0.607, Base Lr: 5.00e-06
2025-12-09 13:29:29,884 DeMo.train INFO: Epoch[6] Iteration[40/54] Loss: 3.963, Acc: 0.610, Base Lr: 5.00e-06
2025-12-09 13:29:32,437 DeMo.train INFO: Epoch[6] Iteration[50/54] Loss: 3.963, Acc: 0.637, Base Lr: 5.00e-06
2025-12-09 13:29:33,327 DeMo.train INFO: Epoch 6 done. Time per batch: 0.302[s] Speed: 211.9[samples/s]
2025-12-09 13:29:33,330 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:29:33,330 DeMo.train INFO: Current is the ori feature testing!
2025-12-09 13:29:33,331 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-09 13:29:43,760 DeMo.train INFO: Validation Results - Epoch: 6
2025-12-09 13:29:43,760 DeMo.train INFO: mAP: 60.2%
2025-12-09 13:29:43,761 DeMo.train INFO: CMC curve, Rank-1  :62.6%
2025-12-09 13:29:43,761 DeMo.train INFO: CMC curve, Rank-5  :73.3%
2025-12-09 13:29:43,761 DeMo.train INFO: CMC curve, Rank-10 :82.3%
2025-12-09 13:29:43,761 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:29:43,865 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:29:43,865 DeMo.train INFO: Current is the moe feature testing!
2025-12-09 13:29:43,865 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-09 13:29:48,922 DeMo.train INFO: Validation Results - Epoch: 6
2025-12-09 13:29:48,922 DeMo.train INFO: mAP: 60.2%
2025-12-09 13:29:48,922 DeMo.train INFO: CMC curve, Rank-1  :62.6%
2025-12-09 13:29:48,922 DeMo.train INFO: CMC curve, Rank-5  :73.3%
2025-12-09 13:29:48,922 DeMo.train INFO: CMC curve, Rank-10 :82.3%
2025-12-09 13:29:48,922 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:29:48,937 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:29:48,937 DeMo.train INFO: Current is the [moe,ori] feature testing!
2025-12-09 13:29:48,938 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-09 13:29:53,898 DeMo.train INFO: Validation Results - Epoch: 6
2025-12-09 13:29:53,899 DeMo.train INFO: mAP: 60.2%
2025-12-09 13:29:53,899 DeMo.train INFO: CMC curve, Rank-1  :62.6%
2025-12-09 13:29:53,899 DeMo.train INFO: CMC curve, Rank-5  :73.3%
2025-12-09 13:29:53,899 DeMo.train INFO: CMC curve, Rank-10 :82.3%
2025-12-09 13:29:53,899 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:29:53,901 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:29:53,902 DeMo.train INFO: Best mAP: 61.3%
2025-12-09 13:29:53,902 DeMo.train INFO: Best Rank-1: 63.5%
2025-12-09 13:29:53,902 DeMo.train INFO: Best Rank-5: 76.6%
2025-12-09 13:29:53,902 DeMo.train INFO: Best Rank-10: 82.3%
2025-12-09 13:29:53,902 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:29:58,020 DeMo.train INFO: Epoch[7] Iteration[10/54] Loss: 3.884, Acc: 0.703, Base Lr: 5.00e-06
2025-12-09 13:30:00,586 DeMo.train INFO: Epoch[7] Iteration[20/54] Loss: 3.915, Acc: 0.708, Base Lr: 5.00e-06
2025-12-09 13:30:03,134 DeMo.train INFO: Epoch[7] Iteration[30/54] Loss: 3.962, Acc: 0.728, Base Lr: 5.00e-06
2025-12-09 13:30:05,670 DeMo.train INFO: Epoch[7] Iteration[40/54] Loss: 4.003, Acc: 0.736, Base Lr: 5.00e-06
2025-12-09 13:30:08,236 DeMo.train INFO: Epoch[7] Iteration[50/54] Loss: 3.991, Acc: 0.719, Base Lr: 5.00e-06
2025-12-09 13:30:09,126 DeMo.train INFO: Epoch 7 done. Time per batch: 0.287[s] Speed: 222.8[samples/s]
2025-12-09 13:30:09,128 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:30:09,129 DeMo.train INFO: Current is the ori feature testing!
2025-12-09 13:30:09,129 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-09 13:30:18,572 DeMo.train INFO: Validation Results - Epoch: 7
2025-12-09 13:30:18,572 DeMo.train INFO: mAP: 65.7%
2025-12-09 13:30:18,573 DeMo.train INFO: CMC curve, Rank-1  :68.3%
2025-12-09 13:30:18,574 DeMo.train INFO: CMC curve, Rank-5  :79.9%
2025-12-09 13:30:18,575 DeMo.train INFO: CMC curve, Rank-10 :86.0%
2025-12-09 13:30:18,575 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:30:19,123 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-09 13:30:19,123 DeMo.train INFO: Current is the moe feature testing!
2025-12-09 13:30:19,124 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
