2025-12-10 15:36:15,825 DeMo INFO: Saving model in the path :..
2025-12-10 15:36:15,825 DeMo INFO: Namespace(config_file='configs/RGBNT201/DeMo_SDTPS_DGAF_ablation.yml', exp_name=None, fea_cft=0, local_rank=0, opts=['MODEL.USE_SDTPS', 'True', 'MODEL.USE_DGAF', 'False', 'MODEL.GLOBAL_LOCAL', 'False', 'MODEL.SDTPS_CROSS_ATTN_TYPE', 'attention', 'MODEL.SDTPS_CROSS_ATTN_HEADS', '4'])
2025-12-10 15:36:15,825 DeMo INFO: Loaded configuration file configs/RGBNT201/DeMo_SDTPS_DGAF_ablation.yml
2025-12-10 15:36:15,826 DeMo INFO: 
MODEL:
  TRANSFORMER_TYPE: 'ViT-B-16'
  STRIDE_SIZE: [ 16, 16 ]
  SIE_CAMERA: True
  DIRECT: 1
  SIE_COE: 1.0
  ID_LOSS_WEIGHT: 0.25
  TRIPLET_LOSS_WEIGHT: 1.0
  GLOBAL_LOCAL: False  # DGAF V3 直接用 tokens，不需要 GLOBAL_LOCAL
  # Disable HDM and ATM
  HDM: False
  ATM: False
  # SACR disabled for ablation
  USE_SACR: False
  USE_MULTIMODAL_SACR: False
  # LIF disabled
  USE_LIF: False
  # SDTPS configuration
  USE_SDTPS: True
  SDTPS_SPARSE_RATIO: 0.7  # token 保留比例（70%）
  SDTPS_USE_GUMBEL: False  # 禁用 Gumbel（训练稳定性）
  SDTPS_GUMBEL_TAU: 5.0
  SDTPS_CROSS_ATTN_TYPE: 'attention'  # 使用 Cross-Attention（推荐）
  SDTPS_CROSS_ATTN_HEADS: 4  # Cross-Attention 头数
  # 已废弃参数（保留兼容性）
  SDTPS_BETA: 0.25         # 已不使用（原 MLP predictor 权重）
  SDTPS_AGGR_RATIO: 0.5    # 已不使用（原 TokenAggregation）
  SDTPS_LOSS_WEIGHT: 2.0   # SDTPS 分支的损失权重
  # DGAF: Dual-Gated Adaptive Fusion
  USE_DGAF: True
  DGAF_VERSION: 'v3'  # V3 接受 (B,N,C) tokens
  DGAF_TAU: 1.0
  DGAF_INIT_ALPHA: 0.5
  DGAF_NUM_HEADS: 8
  HEAD: 4

INPUT:
  SIZE_TRAIN: [ 256, 128 ]
  SIZE_TEST: [ 256, 128 ]
  PROB: 0.5
  RE_PROB: 0.5
  PADDING: 10

DATALOADER:
  SAMPLER: 'softmax_triplet'
  NUM_INSTANCE: 8
  NUM_WORKERS: 14

DATASETS:
  NAMES: ('RGBNT201')
  ROOT_DIR: '..'

SOLVER:
  BASE_LR: 0.000005
  LR_SCHEDULER: 'linear'
  MAX_EPOCHS: 50
  STEPS: [30, 40]
  GAMMA: 0.1
  WARMUP_ITERS: 0
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: 'linear'
  OPTIMIZER_NAME: 'Adam'
  IMS_PER_BATCH: 64
  EVAL_PERIOD: 1
  CHECKPOINT_PERIOD: 10

TEST:
  IMS_PER_BATCH: 128
  RE_RANKING: 'no'
  WEIGHT: ''
  NECK_FEAT: 'before'
  FEAT_NORM: 'yes'
  MISS: "nothing"

OUTPUT_DIR: '..'

# ============================================================================
# SDTPS + DGAF Ablation Config
# ============================================================================
# - SACR: disabled
# - SDTPS: configurable via command line
# - DGAF V3: configurable via command line
# - Training: lr=0.00035, epochs=50, warmup=10
# - TF32: enabled in train_net.py
# ============================================================================

2025-12-10 15:36:15,826 DeMo INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 8
  NUM_WORKERS: 14
  SAMPLER: softmax_triplet
DATASETS:
  NAMES: RGBNT201
  ROOT_DIR: ..
INPUT:
  PADDING: 10
  PIXEL_MEAN: [0.5, 0.5, 0.5]
  PIXEL_STD: [0.5, 0.5, 0.5]
  PROB: 0.5
  RE_PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
MODEL:
  ADAPTER: False
  ATM: False
  ATT_DROP_RATE: 0.0
  DEVICE: cuda
  DEVICE_ID: 0
  DGAF_INIT_ALPHA: 0.5
  DGAF_NUM_HEADS: 8
  DGAF_TAU: 1.0
  DGAF_VERSION: v3
  DIRECT: 1
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FROZEN: False
  GLOBAL_LOCAL: False
  HDM: False
  HEAD: 4
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 0.25
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LIF_BETA: 0.4
  LIF_LAYER: 3
  LIF_LOSS_WEIGHT: 0.1
  METRIC_LOSS_TYPE: triplet
  MULTIMODAL_SACR_VERSION: v1
  NAME: DeMo
  NECK: bnneck
  NO_MARGIN: True
  PRETRAIN_PATH_T: /path/to/your/vitb_16_224_21k.pth
  PROMPT: False
  SACR_DILATION_RATES: [2, 3, 4]
  SDTPS_AGGR_RATIO: 0.5
  SDTPS_BETA: 0.25
  SDTPS_CROSS_ATTN_HEADS: 4
  SDTPS_CROSS_ATTN_TYPE: attention
  SDTPS_GUMBEL_TAU: 5.0
  SDTPS_LOSS_WEIGHT: 2.0
  SDTPS_SPARSE_RATIO: 0.7
  SDTPS_USE_GUMBEL: False
  SIE_CAMERA: True
  SIE_COE: 1.0
  SIE_VIEW: False
  STRIDE_SIZE: [16, 16]
  TRANSFORMER_TYPE: ViT-B-16
  TRIPLET_LOSS_WEIGHT: 1.0
  USE_DGAF: False
  USE_LIF: False
  USE_MULTIMODAL_SACR: False
  USE_SACR: False
  USE_SDTPS: True
OUTPUT_DIR: ..
SOLVER:
  BASE_LR: 5e-06
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.1
  IMS_PER_BATCH: 64
  LARGE_FC_LR: False
  LOG_PERIOD: 10
  LR_SCHEDULER: linear
  MARGIN: 0.3
  MAX_EPOCHS: 50
  MOMENTUM: 0.9
  OPTIMIZER_NAME: Adam
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (30, 40)
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 0
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
TEST:
  FEAT: 0
  FEAT_NORM: yes
  IMS_PER_BATCH: 128
  MISS: nothing
  NECK_FEAT: before
  RE_RANKING: no
  WEIGHT: 
=> RGBNT201 loaded
Dataset statistics:
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train    |   171 |     3951 |         4
  query    |    30 |      836 |         2
  gallery  |    30 |      836 |         2
  ----------------------------------------
data is ready
using Transformer_type: ViT-B-16 as a backbone
Resized position embedding: %s to %s torch.Size([197, 768]) torch.Size([129, 768])
Position embedding resize to height:16 width: 8
Successfully load ckpt!
<All keys matched successfully>
Loading pretrained model from CLIP
camera number is : 4
===========Building DeMo===========
2025-12-10 15:36:27,500 DeMo INFO: DeMo(
  (BACKBONE): build_transformer(
    (base): VisionTransformer(
      (conv1): Conv2d(3, 768, kernel_size=(16, 16), stride=(16, 16), bias=False)
      (ln_pre): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
      (transformer): Transformer(
        (resblocks): Sequential(
          (0): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (1): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (2): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (3): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (4): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (5): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (6): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (7): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (8): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (9): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (10): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (11): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
        )
      )
      (ln_post): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
    )
  )
  (pool): AdaptiveAvgPool1d(output_size=1)
  (rgb_reduce): Sequential(
    (0): LayerNorm((1024,), eps=1e-05, elementwise_affine=True)
    (1): Linear(in_features=1024, out_features=512, bias=True)
    (2): QuickGELU()
  )
  (nir_reduce): Sequential(
    (0): LayerNorm((1024,), eps=1e-05, elementwise_affine=True)
    (1): Linear(in_features=1024, out_features=512, bias=True)
    (2): QuickGELU()
  )
  (tir_reduce): Sequential(
    (0): LayerNorm((1024,), eps=1e-05, elementwise_affine=True)
    (1): Linear(in_features=1024, out_features=512, bias=True)
    (2): QuickGELU()
  )
  (sdtps): MultiModalSDTPS(
    (rgb_sparse): TokenSparse(
      (modal_weight_mlp): Sequential(
        (0): Linear(in_features=1536, out_features=256, bias=True)
        (1): LayerNorm((256,), eps=1e-05, elementwise_affine=True)
        (2): GELU(approximate='none')
        (3): Dropout(p=0.1, inplace=False)
        (4): Linear(in_features=256, out_features=64, bias=True)
        (5): GELU(approximate='none')
        (6): Linear(in_features=64, out_features=3, bias=True)
      )
    )
    (nir_sparse): TokenSparse(
      (modal_weight_mlp): Sequential(
        (0): Linear(in_features=1536, out_features=256, bias=True)
        (1): LayerNorm((256,), eps=1e-05, elementwise_affine=True)
        (2): GELU(approximate='none')
        (3): Dropout(p=0.1, inplace=False)
        (4): Linear(in_features=256, out_features=64, bias=True)
        (5): GELU(approximate='none')
        (6): Linear(in_features=64, out_features=3, bias=True)
      )
    )
    (tir_sparse): TokenSparse(
      (modal_weight_mlp): Sequential(
        (0): Linear(in_features=1536, out_features=256, bias=True)
        (1): LayerNorm((256,), eps=1e-05, elementwise_affine=True)
        (2): GELU(approximate='none')
        (3): Dropout(p=0.1, inplace=False)
        (4): Linear(in_features=256, out_features=64, bias=True)
        (5): GELU(approximate='none')
        (6): Linear(in_features=64, out_features=3, bias=True)
      )
    )
    (rgb_self_attn): CrossModalAttention(
      (q_proj): Linear(in_features=512, out_features=512, bias=True)
      (k_proj): Linear(in_features=512, out_features=512, bias=True)
      (attn_drop): Dropout(p=0.0, inplace=False)
    )
    (rgb_cross_nir): CrossModalAttention(
      (q_proj): Linear(in_features=512, out_features=512, bias=True)
      (k_proj): Linear(in_features=512, out_features=512, bias=True)
      (attn_drop): Dropout(p=0.0, inplace=False)
    )
    (rgb_cross_tir): CrossModalAttention(
      (q_proj): Linear(in_features=512, out_features=512, bias=True)
      (k_proj): Linear(in_features=512, out_features=512, bias=True)
      (attn_drop): Dropout(p=0.0, inplace=False)
    )
    (nir_self_attn): CrossModalAttention(
      (q_proj): Linear(in_features=512, out_features=512, bias=True)
      (k_proj): Linear(in_features=512, out_features=512, bias=True)
      (attn_drop): Dropout(p=0.0, inplace=False)
    )
    (nir_cross_rgb): CrossModalAttention(
      (q_proj): Linear(in_features=512, out_features=512, bias=True)
      (k_proj): Linear(in_features=512, out_features=512, bias=True)
      (attn_drop): Dropout(p=0.0, inplace=False)
    )
    (nir_cross_tir): CrossModalAttention(
      (q_proj): Linear(in_features=512, out_features=512, bias=True)
      (k_proj): Linear(in_features=512, out_features=512, bias=True)
      (attn_drop): Dropout(p=0.0, inplace=False)
    )
    (tir_self_attn): CrossModalAttention(
      (q_proj): Linear(in_features=512, out_features=512, bias=True)
      (k_proj): Linear(in_features=512, out_features=512, bias=True)
      (attn_drop): Dropout(p=0.0, inplace=False)
    )
    (tir_cross_rgb): CrossModalAttention(
      (q_proj): Linear(in_features=512, out_features=512, bias=True)
      (k_proj): Linear(in_features=512, out_features=512, bias=True)
      (attn_drop): Dropout(p=0.0, inplace=False)
    )
    (tir_cross_nir): CrossModalAttention(
      (q_proj): Linear(in_features=512, out_features=512, bias=True)
      (k_proj): Linear(in_features=512, out_features=512, bias=True)
      (attn_drop): Dropout(p=0.0, inplace=False)
    )
  )
  (classifier_sdtps): Linear(in_features=1536, out_features=171, bias=False)
  (bottleneck_sdtps): BatchNorm1d(1536, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
  (classifier): Linear(in_features=1536, out_features=171, bias=False)
  (bottleneck): BatchNorm1d(1536, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
)
2025-12-10 15:36:27,501 DeMo INFO: number of parameters:94.212105
/home/yij/miniconda3/envs/DeMo/lib/python3.8/site-packages/timm/models/helpers.py:7: FutureWarning: Importing from timm.models.helpers is deprecated, please import via timm.models
  warnings.warn(f"Importing from {__name__} is deprecated, please import via timm.models", FutureWarning)
/home/yij/miniconda3/envs/DeMo/lib/python3.8/site-packages/timm/models/registry.py:4: FutureWarning: Importing from timm.models.registry is deprecated, please import via timm.models
  warnings.warn(f"Importing from {__name__} is deprecated, please import via timm.models", FutureWarning)
/home/yij/miniconda3/envs/DeMo/lib/python3.8/site-packages/timm/models/layers/__init__.py:48: FutureWarning: Importing from timm.models.layers is deprecated, please import via timm.layers
  warnings.warn(f"Importing from {__name__} is deprecated, please import via timm.layers", FutureWarning)
/raid/yij/icme/demo2new/DeMo2/modeling/clip/clip.py:23: UserWarning: PyTorch version 1.7.1 or higher is recommended
  warnings.warn("PyTorch version 1.7.1 or higher is recommended")
/home/yij/miniconda3/envs/DeMo/lib/python3.8/site-packages/torchvision/transforms/transforms.py:329: UserWarning: Argument 'interpolation' of type int is deprecated since 0.13 and will be removed in 0.15. Please use InterpolationMode enum.
  warnings.warn(
Unsupported operator aten::std encountered 9 time(s)
Unsupported operator aten::quantile encountered 3 time(s)
The following submodules of the model were never called during the trace of the graph. They may be unused, or they were accessed by direct calls to .forward() or via other python methods. In the latter case they will have zeros for statistics, though their statistics will still contribute to their parent calling module.
BACKBONE.base.transformer.resblocks.0.attn.out_proj, BACKBONE.base.transformer.resblocks.1.attn.out_proj, BACKBONE.base.transformer.resblocks.10.attn.out_proj, BACKBONE.base.transformer.resblocks.11.attn.out_proj, BACKBONE.base.transformer.resblocks.2.attn.out_proj, BACKBONE.base.transformer.resblocks.3.attn.out_proj, BACKBONE.base.transformer.resblocks.4.attn.out_proj, BACKBONE.base.transformer.resblocks.5.attn.out_proj, BACKBONE.base.transformer.resblocks.6.attn.out_proj, BACKBONE.base.transformer.resblocks.7.attn.out_proj, BACKBONE.base.transformer.resblocks.8.attn.out_proj, BACKBONE.base.transformer.resblocks.9.attn.out_proj, bottleneck, bottleneck_sdtps, classifier, classifier_sdtps, nir_reduce, nir_reduce.0, nir_reduce.1, nir_reduce.2, pool, rgb_reduce, rgb_reduce.0, rgb_reduce.1, rgb_reduce.2, tir_reduce, tir_reduce.0, tir_reduce.1, tir_reduce.2
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Note: out_proj is calculated in MultiheadAttention.forward(), ignore it
Note: bottleneck/classifier not used in inference, ignore it
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:36:30,394 DeMo INFO: number of GFLOPs: 34.58373971099999
using soft triplet loss for training
label smooth on, numclasses: 171
2025-12-10 15:36:30,414 DeMo INFO: TensorBoard logging to: logs/tensorboard/DeMo_SDTPS_DGAF_ablation_20251210_153630
2025-12-10 15:36:30,414 DeMo INFO: Start TensorBoard with: tensorboard --logdir logs/tensorboard --port 6006
2025-12-10 15:36:30,414 DeMo.train INFO: start training
/home/yij/miniconda3/envs/DeMo/lib/python3.8/site-packages/torch/optim/lr_scheduler.py:138: UserWarning: Detected call of `lr_scheduler.step()` before `optimizer.step()`. In PyTorch 1.1.0 and later, you should call them in the opposite order: `optimizer.step()` before `lr_scheduler.step()`.  Failure to do this will result in PyTorch skipping the first value of the learning rate schedule. See more details at https://pytorch.org/docs/stable/optim.html#how-to-adjust-learning-rate
  warnings.warn("Detected call of `lr_scheduler.step()` before `optimizer.step()`. "
/home/yij/miniconda3/envs/DeMo/lib/python3.8/site-packages/torch/optim/lr_scheduler.py:163: UserWarning: The epoch parameter in `scheduler.step()` was not necessary and is being deprecated where possible. Please use `scheduler.step()` to step the scheduler. During the deprecation, if epoch is different from None, the closed form is used instead of the new chainable form, where available. Please open an issue if you are unable to replicate your use case: https://github.com/pytorch/pytorch/issues/new/choose.
  warnings.warn(EPOCH_DEPRECATION_WARNING, UserWarning)
2025-12-10 15:36:35,966 DeMo.train INFO: Epoch[1] Iteration[10/54] Loss: 4.319, Acc: 0.005, Base Lr: 5.00e-06
2025-12-10 15:36:38,560 DeMo.train INFO: Epoch[1] Iteration[20/54] Loss: 4.188, Acc: 0.006, Base Lr: 5.00e-06
2025-12-10 15:36:41,092 DeMo.train INFO: Epoch[1] Iteration[30/54] Loss: 4.145, Acc: 0.008, Base Lr: 5.00e-06
2025-12-10 15:36:43,652 DeMo.train INFO: Epoch[1] Iteration[40/54] Loss: 4.107, Acc: 0.009, Base Lr: 5.00e-06
2025-12-10 15:36:46,214 DeMo.train INFO: Epoch[1] Iteration[50/54] Loss: 4.082, Acc: 0.009, Base Lr: 5.00e-06
2025-12-10 15:36:47,134 DeMo.train INFO: Epoch 1 done. Time per batch: 0.315[s] Speed: 203.2[samples/s]
2025-12-10 15:36:47,136 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:36:47,136 DeMo.train INFO: Current is the ori feature testing!
2025-12-10 15:36:47,136 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:36:52,834 DeMo.train INFO: Validation Results - Epoch: 1
2025-12-10 15:36:52,834 DeMo.train INFO: mAP: 17.9%
2025-12-10 15:36:52,834 DeMo.train INFO: CMC curve, Rank-1  :16.6%
2025-12-10 15:36:52,834 DeMo.train INFO: CMC curve, Rank-5  :32.9%
2025-12-10 15:36:52,834 DeMo.train INFO: CMC curve, Rank-10 :40.4%
2025-12-10 15:36:52,835 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:36:52,836 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:36:52,836 DeMo.train INFO: Current is the moe feature testing!
2025-12-10 15:36:52,836 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:36:57,714 DeMo.train INFO: Validation Results - Epoch: 1
2025-12-10 15:36:57,714 DeMo.train INFO: mAP: 17.9%
2025-12-10 15:36:57,714 DeMo.train INFO: CMC curve, Rank-1  :16.6%
2025-12-10 15:36:57,714 DeMo.train INFO: CMC curve, Rank-5  :32.9%
2025-12-10 15:36:57,714 DeMo.train INFO: CMC curve, Rank-10 :40.4%
2025-12-10 15:36:57,714 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:36:58,710 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:36:58,711 DeMo.train INFO: Current is the [moe,ori] feature testing!
2025-12-10 15:36:58,711 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:37:04,588 DeMo.train INFO: Validation Results - Epoch: 1
2025-12-10 15:37:04,589 DeMo.train INFO: mAP: 17.9%
2025-12-10 15:37:04,589 DeMo.train INFO: CMC curve, Rank-1  :16.6%
2025-12-10 15:37:04,589 DeMo.train INFO: CMC curve, Rank-5  :32.9%
2025-12-10 15:37:04,589 DeMo.train INFO: CMC curve, Rank-10 :40.4%
2025-12-10 15:37:04,589 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:37:05,227 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:37:05,227 DeMo.train INFO: Best mAP: 17.9%
2025-12-10 15:37:05,227 DeMo.train INFO: Best Rank-1: 16.6%
2025-12-10 15:37:05,227 DeMo.train INFO: Best Rank-5: 32.9%
2025-12-10 15:37:05,228 DeMo.train INFO: Best Rank-10: 40.4%
2025-12-10 15:37:05,228 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:37:09,147 DeMo.train INFO: Epoch[2] Iteration[10/54] Loss: 3.900, Acc: 0.031, Base Lr: 5.00e-06
2025-12-10 15:37:11,721 DeMo.train INFO: Epoch[2] Iteration[20/54] Loss: 3.888, Acc: 0.029, Base Lr: 5.00e-06
2025-12-10 15:37:14,401 DeMo.train INFO: Epoch[2] Iteration[30/54] Loss: 3.871, Acc: 0.036, Base Lr: 5.00e-06
2025-12-10 15:37:16,993 DeMo.train INFO: Epoch[2] Iteration[40/54] Loss: 3.846, Acc: 0.043, Base Lr: 5.00e-06
2025-12-10 15:37:19,582 DeMo.train INFO: Epoch[2] Iteration[50/54] Loss: 3.815, Acc: 0.057, Base Lr: 5.00e-06
2025-12-10 15:37:20,476 DeMo.train INFO: Epoch 2 done. Time per batch: 0.288[s] Speed: 222.5[samples/s]
2025-12-10 15:37:20,477 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:37:20,478 DeMo.train INFO: Current is the ori feature testing!
2025-12-10 15:37:20,478 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:37:25,218 DeMo.train INFO: Validation Results - Epoch: 2
2025-12-10 15:37:25,219 DeMo.train INFO: mAP: 42.9%
2025-12-10 15:37:25,219 DeMo.train INFO: CMC curve, Rank-1  :43.5%
2025-12-10 15:37:25,219 DeMo.train INFO: CMC curve, Rank-5  :57.5%
2025-12-10 15:37:25,219 DeMo.train INFO: CMC curve, Rank-10 :65.9%
2025-12-10 15:37:25,219 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:37:26,310 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:37:26,311 DeMo.train INFO: Current is the moe feature testing!
2025-12-10 15:37:26,311 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:37:31,705 DeMo.train INFO: Validation Results - Epoch: 2
2025-12-10 15:37:31,705 DeMo.train INFO: mAP: 42.9%
2025-12-10 15:37:31,705 DeMo.train INFO: CMC curve, Rank-1  :43.5%
2025-12-10 15:37:31,706 DeMo.train INFO: CMC curve, Rank-5  :57.5%
2025-12-10 15:37:31,706 DeMo.train INFO: CMC curve, Rank-10 :65.9%
2025-12-10 15:37:31,706 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:37:31,709 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:37:31,709 DeMo.train INFO: Current is the [moe,ori] feature testing!
2025-12-10 15:37:31,709 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:37:36,542 DeMo.train INFO: Validation Results - Epoch: 2
2025-12-10 15:37:36,542 DeMo.train INFO: mAP: 42.9%
2025-12-10 15:37:36,542 DeMo.train INFO: CMC curve, Rank-1  :43.5%
2025-12-10 15:37:36,543 DeMo.train INFO: CMC curve, Rank-5  :57.5%
2025-12-10 15:37:36,543 DeMo.train INFO: CMC curve, Rank-10 :65.9%
2025-12-10 15:37:36,543 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:37:37,053 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:37:37,054 DeMo.train INFO: Best mAP: 42.9%
2025-12-10 15:37:37,054 DeMo.train INFO: Best Rank-1: 43.5%
2025-12-10 15:37:37,054 DeMo.train INFO: Best Rank-5: 57.5%
2025-12-10 15:37:37,054 DeMo.train INFO: Best Rank-10: 65.9%
2025-12-10 15:37:37,054 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:37:41,057 DeMo.train INFO: Epoch[3] Iteration[10/54] Loss: 3.573, Acc: 0.155, Base Lr: 5.00e-06
2025-12-10 15:37:44,291 DeMo.train INFO: Epoch[3] Iteration[20/54] Loss: 3.575, Acc: 0.163, Base Lr: 5.00e-06
2025-12-10 15:37:46,847 DeMo.train INFO: Epoch[3] Iteration[30/54] Loss: 3.542, Acc: 0.176, Base Lr: 5.00e-06
2025-12-10 15:37:49,466 DeMo.train INFO: Epoch[3] Iteration[40/54] Loss: 3.512, Acc: 0.182, Base Lr: 5.00e-06
2025-12-10 15:37:52,041 DeMo.train INFO: Epoch[3] Iteration[50/54] Loss: 3.514, Acc: 0.189, Base Lr: 5.00e-06
2025-12-10 15:37:53,083 DeMo.train INFO: Epoch 3 done. Time per batch: 0.302[s] Speed: 211.6[samples/s]
2025-12-10 15:37:53,088 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:37:53,088 DeMo.train INFO: Current is the ori feature testing!
2025-12-10 15:37:53,088 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:37:58,760 DeMo.train INFO: Validation Results - Epoch: 3
2025-12-10 15:37:58,761 DeMo.train INFO: mAP: 54.2%
2025-12-10 15:37:58,761 DeMo.train INFO: CMC curve, Rank-1  :55.1%
2025-12-10 15:37:58,761 DeMo.train INFO: CMC curve, Rank-5  :70.0%
2025-12-10 15:37:58,761 DeMo.train INFO: CMC curve, Rank-10 :77.0%
2025-12-10 15:37:58,761 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:38:00,246 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:38:00,246 DeMo.train INFO: Current is the moe feature testing!
2025-12-10 15:38:00,246 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:38:06,020 DeMo.train INFO: Validation Results - Epoch: 3
2025-12-10 15:38:06,020 DeMo.train INFO: mAP: 54.2%
2025-12-10 15:38:06,020 DeMo.train INFO: CMC curve, Rank-1  :55.1%
2025-12-10 15:38:06,020 DeMo.train INFO: CMC curve, Rank-5  :70.0%
2025-12-10 15:38:06,021 DeMo.train INFO: CMC curve, Rank-10 :77.0%
2025-12-10 15:38:06,021 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:38:06,024 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:38:06,024 DeMo.train INFO: Current is the [moe,ori] feature testing!
2025-12-10 15:38:06,024 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:38:10,965 DeMo.train INFO: Validation Results - Epoch: 3
2025-12-10 15:38:10,966 DeMo.train INFO: mAP: 54.2%
2025-12-10 15:38:10,966 DeMo.train INFO: CMC curve, Rank-1  :55.1%
2025-12-10 15:38:10,966 DeMo.train INFO: CMC curve, Rank-5  :70.0%
2025-12-10 15:38:10,966 DeMo.train INFO: CMC curve, Rank-10 :77.0%
2025-12-10 15:38:10,966 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:38:11,574 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:38:11,575 DeMo.train INFO: Best mAP: 54.2%
2025-12-10 15:38:11,575 DeMo.train INFO: Best Rank-1: 55.1%
2025-12-10 15:38:11,575 DeMo.train INFO: Best Rank-5: 70.0%
2025-12-10 15:38:11,575 DeMo.train INFO: Best Rank-10: 77.0%
2025-12-10 15:38:11,575 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:38:15,460 DeMo.train INFO: Epoch[4] Iteration[10/54] Loss: 3.214, Acc: 0.364, Base Lr: 5.00e-06
2025-12-10 15:38:18,067 DeMo.train INFO: Epoch[4] Iteration[20/54] Loss: 3.171, Acc: 0.385, Base Lr: 5.00e-06
2025-12-10 15:38:20,648 DeMo.train INFO: Epoch[4] Iteration[30/54] Loss: 3.184, Acc: 0.365, Base Lr: 5.00e-06
2025-12-10 15:38:23,237 DeMo.train INFO: Epoch[4] Iteration[40/54] Loss: 3.169, Acc: 0.390, Base Lr: 5.00e-06
2025-12-10 15:38:25,820 DeMo.train INFO: Epoch[4] Iteration[50/54] Loss: 3.162, Acc: 0.401, Base Lr: 5.00e-06
2025-12-10 15:38:26,731 DeMo.train INFO: Epoch 4 done. Time per batch: 0.286[s] Speed: 223.8[samples/s]
2025-12-10 15:38:26,732 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:38:26,732 DeMo.train INFO: Current is the ori feature testing!
2025-12-10 15:38:26,732 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:38:31,478 DeMo.train INFO: Validation Results - Epoch: 4
2025-12-10 15:38:31,478 DeMo.train INFO: mAP: 61.2%
2025-12-10 15:38:31,478 DeMo.train INFO: CMC curve, Rank-1  :60.0%
2025-12-10 15:38:31,478 DeMo.train INFO: CMC curve, Rank-5  :73.6%
2025-12-10 15:38:31,479 DeMo.train INFO: CMC curve, Rank-10 :81.7%
2025-12-10 15:38:31,479 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:38:32,384 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:38:32,384 DeMo.train INFO: Current is the moe feature testing!
2025-12-10 15:38:32,384 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:38:37,830 DeMo.train INFO: Validation Results - Epoch: 4
2025-12-10 15:38:37,831 DeMo.train INFO: mAP: 61.2%
2025-12-10 15:38:37,831 DeMo.train INFO: CMC curve, Rank-1  :60.0%
2025-12-10 15:38:37,831 DeMo.train INFO: CMC curve, Rank-5  :73.6%
2025-12-10 15:38:37,831 DeMo.train INFO: CMC curve, Rank-10 :81.7%
2025-12-10 15:38:37,831 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:38:37,834 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:38:37,834 DeMo.train INFO: Current is the [moe,ori] feature testing!
2025-12-10 15:38:37,834 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:38:42,723 DeMo.train INFO: Validation Results - Epoch: 4
2025-12-10 15:38:42,724 DeMo.train INFO: mAP: 61.2%
2025-12-10 15:38:42,724 DeMo.train INFO: CMC curve, Rank-1  :60.0%
2025-12-10 15:38:42,724 DeMo.train INFO: CMC curve, Rank-5  :73.6%
2025-12-10 15:38:42,724 DeMo.train INFO: CMC curve, Rank-10 :81.7%
2025-12-10 15:38:42,724 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:38:43,217 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:38:43,217 DeMo.train INFO: Best mAP: 61.2%
2025-12-10 15:38:43,217 DeMo.train INFO: Best Rank-1: 60.0%
2025-12-10 15:38:43,217 DeMo.train INFO: Best Rank-5: 73.6%
2025-12-10 15:38:43,218 DeMo.train INFO: Best Rank-10: 81.7%
2025-12-10 15:38:43,218 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:38:47,127 DeMo.train INFO: Epoch[5] Iteration[10/54] Loss: 2.893, Acc: 0.586, Base Lr: 5.00e-06
2025-12-10 15:38:49,757 DeMo.train INFO: Epoch[5] Iteration[20/54] Loss: 2.902, Acc: 0.568, Base Lr: 5.00e-06
2025-12-10 15:38:52,346 DeMo.train INFO: Epoch[5] Iteration[30/54] Loss: 2.880, Acc: 0.524, Base Lr: 5.00e-06
2025-12-10 15:38:54,958 DeMo.train INFO: Epoch[5] Iteration[40/54] Loss: 2.861, Acc: 0.540, Base Lr: 5.00e-06
2025-12-10 15:38:57,567 DeMo.train INFO: Epoch[5] Iteration[50/54] Loss: 2.897, Acc: 0.545, Base Lr: 5.00e-06
2025-12-10 15:38:58,473 DeMo.train INFO: Epoch 5 done. Time per batch: 0.288[s] Speed: 222.3[samples/s]
2025-12-10 15:38:58,475 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:38:58,475 DeMo.train INFO: Current is the ori feature testing!
2025-12-10 15:38:58,475 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:39:03,595 DeMo.train INFO: Validation Results - Epoch: 5
2025-12-10 15:39:03,595 DeMo.train INFO: mAP: 63.9%
2025-12-10 15:39:03,595 DeMo.train INFO: CMC curve, Rank-1  :65.0%
2025-12-10 15:39:03,595 DeMo.train INFO: CMC curve, Rank-5  :78.9%
2025-12-10 15:39:03,595 DeMo.train INFO: CMC curve, Rank-10 :85.2%
2025-12-10 15:39:03,595 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:39:04,166 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:39:04,166 DeMo.train INFO: Current is the moe feature testing!
2025-12-10 15:39:04,166 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:39:10,040 DeMo.train INFO: Validation Results - Epoch: 5
2025-12-10 15:39:10,040 DeMo.train INFO: mAP: 63.9%
2025-12-10 15:39:10,040 DeMo.train INFO: CMC curve, Rank-1  :65.0%
2025-12-10 15:39:10,040 DeMo.train INFO: CMC curve, Rank-5  :78.9%
2025-12-10 15:39:10,041 DeMo.train INFO: CMC curve, Rank-10 :85.2%
2025-12-10 15:39:10,041 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:39:10,044 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:39:10,044 DeMo.train INFO: Current is the [moe,ori] feature testing!
2025-12-10 15:39:10,044 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:39:15,199 DeMo.train INFO: Validation Results - Epoch: 5
2025-12-10 15:39:15,200 DeMo.train INFO: mAP: 63.9%
2025-12-10 15:39:15,200 DeMo.train INFO: CMC curve, Rank-1  :65.0%
2025-12-10 15:39:15,200 DeMo.train INFO: CMC curve, Rank-5  :78.9%
2025-12-10 15:39:15,200 DeMo.train INFO: CMC curve, Rank-10 :85.2%
2025-12-10 15:39:15,200 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:39:16,551 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:39:16,552 DeMo.train INFO: Best mAP: 63.9%
2025-12-10 15:39:16,552 DeMo.train INFO: Best Rank-1: 65.0%
2025-12-10 15:39:16,552 DeMo.train INFO: Best Rank-5: 78.9%
2025-12-10 15:39:16,552 DeMo.train INFO: Best Rank-10: 85.2%
2025-12-10 15:39:16,552 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:39:21,267 DeMo.train INFO: Epoch[6] Iteration[10/54] Loss: 2.867, Acc: 0.589, Base Lr: 5.00e-06
2025-12-10 15:39:23,855 DeMo.train INFO: Epoch[6] Iteration[20/54] Loss: 2.912, Acc: 0.595, Base Lr: 5.00e-06
2025-12-10 15:39:26,430 DeMo.train INFO: Epoch[6] Iteration[30/54] Loss: 2.896, Acc: 0.644, Base Lr: 5.00e-06
2025-12-10 15:39:29,011 DeMo.train INFO: Epoch[6] Iteration[40/54] Loss: 2.887, Acc: 0.639, Base Lr: 5.00e-06
2025-12-10 15:39:31,635 DeMo.train INFO: Epoch[6] Iteration[50/54] Loss: 2.869, Acc: 0.661, Base Lr: 5.00e-06
2025-12-10 15:39:32,526 DeMo.train INFO: Epoch 6 done. Time per batch: 0.301[s] Speed: 212.3[samples/s]
2025-12-10 15:39:32,528 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:39:32,528 DeMo.train INFO: Current is the ori feature testing!
2025-12-10 15:39:32,528 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:39:37,858 DeMo.train INFO: Validation Results - Epoch: 6
2025-12-10 15:39:37,858 DeMo.train INFO: mAP: 67.2%
2025-12-10 15:39:37,858 DeMo.train INFO: CMC curve, Rank-1  :69.9%
2025-12-10 15:39:37,858 DeMo.train INFO: CMC curve, Rank-5  :78.3%
2025-12-10 15:39:37,858 DeMo.train INFO: CMC curve, Rank-10 :84.8%
2025-12-10 15:39:37,858 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:39:38,424 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:39:38,424 DeMo.train INFO: Current is the moe feature testing!
2025-12-10 15:39:38,424 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:39:44,241 DeMo.train INFO: Validation Results - Epoch: 6
2025-12-10 15:39:44,242 DeMo.train INFO: mAP: 67.2%
2025-12-10 15:39:44,242 DeMo.train INFO: CMC curve, Rank-1  :69.9%
2025-12-10 15:39:44,242 DeMo.train INFO: CMC curve, Rank-5  :78.3%
2025-12-10 15:39:44,242 DeMo.train INFO: CMC curve, Rank-10 :84.8%
2025-12-10 15:39:44,242 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:39:44,245 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:39:44,246 DeMo.train INFO: Current is the [moe,ori] feature testing!
2025-12-10 15:39:44,246 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:39:49,310 DeMo.train INFO: Validation Results - Epoch: 6
2025-12-10 15:39:49,311 DeMo.train INFO: mAP: 67.2%
2025-12-10 15:39:49,311 DeMo.train INFO: CMC curve, Rank-1  :69.9%
2025-12-10 15:39:49,311 DeMo.train INFO: CMC curve, Rank-5  :78.3%
2025-12-10 15:39:49,311 DeMo.train INFO: CMC curve, Rank-10 :84.8%
2025-12-10 15:39:49,311 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:39:49,870 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:39:49,871 DeMo.train INFO: Best mAP: 67.2%
2025-12-10 15:39:49,871 DeMo.train INFO: Best Rank-1: 69.9%
2025-12-10 15:39:49,871 DeMo.train INFO: Best Rank-5: 78.3%
2025-12-10 15:39:49,871 DeMo.train INFO: Best Rank-10: 84.8%
2025-12-10 15:39:49,871 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:39:53,877 DeMo.train INFO: Epoch[7] Iteration[10/54] Loss: 2.713, Acc: 0.786, Base Lr: 5.00e-06
2025-12-10 15:39:56,538 DeMo.train INFO: Epoch[7] Iteration[20/54] Loss: 2.666, Acc: 0.762, Base Lr: 5.00e-06
2025-12-10 15:39:59,138 DeMo.train INFO: Epoch[7] Iteration[30/54] Loss: 2.652, Acc: 0.734, Base Lr: 5.00e-06
2025-12-10 15:40:01,857 DeMo.train INFO: Epoch[7] Iteration[40/54] Loss: 2.646, Acc: 0.732, Base Lr: 5.00e-06
2025-12-10 15:40:04,455 DeMo.train INFO: Epoch[7] Iteration[50/54] Loss: 2.666, Acc: 0.732, Base Lr: 5.00e-06
2025-12-10 15:40:05,368 DeMo.train INFO: Epoch 7 done. Time per batch: 0.292[s] Speed: 218.9[samples/s]
2025-12-10 15:40:05,371 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:40:05,371 DeMo.train INFO: Current is the ori feature testing!
2025-12-10 15:40:05,371 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:40:10,547 DeMo.train INFO: Validation Results - Epoch: 7
2025-12-10 15:40:10,548 DeMo.train INFO: mAP: 63.6%
2025-12-10 15:40:10,548 DeMo.train INFO: CMC curve, Rank-1  :66.7%
2025-12-10 15:40:10,548 DeMo.train INFO: CMC curve, Rank-5  :76.1%
2025-12-10 15:40:10,548 DeMo.train INFO: CMC curve, Rank-10 :82.3%
2025-12-10 15:40:10,548 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:40:10,887 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:40:10,888 DeMo.train INFO: Current is the moe feature testing!
2025-12-10 15:40:10,888 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:40:17,454 DeMo.train INFO: Validation Results - Epoch: 7
2025-12-10 15:40:17,455 DeMo.train INFO: mAP: 63.6%
2025-12-10 15:40:17,455 DeMo.train INFO: CMC curve, Rank-1  :66.7%
2025-12-10 15:40:17,455 DeMo.train INFO: CMC curve, Rank-5  :76.1%
2025-12-10 15:40:17,455 DeMo.train INFO: CMC curve, Rank-10 :82.3%
2025-12-10 15:40:17,455 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:40:17,924 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:40:17,924 DeMo.train INFO: Current is the [moe,ori] feature testing!
2025-12-10 15:40:17,924 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:40:23,966 DeMo.train INFO: Validation Results - Epoch: 7
2025-12-10 15:40:23,966 DeMo.train INFO: mAP: 63.6%
2025-12-10 15:40:23,966 DeMo.train INFO: CMC curve, Rank-1  :66.7%
2025-12-10 15:40:23,966 DeMo.train INFO: CMC curve, Rank-5  :76.1%
2025-12-10 15:40:23,966 DeMo.train INFO: CMC curve, Rank-10 :82.3%
2025-12-10 15:40:23,966 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:40:23,969 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:40:23,969 DeMo.train INFO: Best mAP: 67.2%
2025-12-10 15:40:23,969 DeMo.train INFO: Best Rank-1: 69.9%
2025-12-10 15:40:23,969 DeMo.train INFO: Best Rank-5: 78.3%
2025-12-10 15:40:23,969 DeMo.train INFO: Best Rank-10: 84.8%
2025-12-10 15:40:23,969 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:40:28,213 DeMo.train INFO: Epoch[8] Iteration[10/54] Loss: 2.630, Acc: 0.784, Base Lr: 5.00e-06
2025-12-10 15:40:30,857 DeMo.train INFO: Epoch[8] Iteration[20/54] Loss: 2.621, Acc: 0.767, Base Lr: 5.00e-06
2025-12-10 15:40:33,445 DeMo.train INFO: Epoch[8] Iteration[30/54] Loss: 2.615, Acc: 0.775, Base Lr: 5.00e-06
2025-12-10 15:40:36,159 DeMo.train INFO: Epoch[8] Iteration[40/54] Loss: 2.622, Acc: 0.775, Base Lr: 5.00e-06
2025-12-10 15:40:38,758 DeMo.train INFO: Epoch[8] Iteration[50/54] Loss: 2.620, Acc: 0.781, Base Lr: 5.00e-06
2025-12-10 15:40:39,669 DeMo.train INFO: Epoch 8 done. Time per batch: 0.296[s] Speed: 216.1[samples/s]
2025-12-10 15:40:39,670 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:40:39,670 DeMo.train INFO: Current is the ori feature testing!
2025-12-10 15:40:39,670 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:40:44,441 DeMo.train INFO: Validation Results - Epoch: 8
2025-12-10 15:40:44,442 DeMo.train INFO: mAP: 69.9%
2025-12-10 15:40:44,442 DeMo.train INFO: CMC curve, Rank-1  :71.3%
2025-12-10 15:40:44,442 DeMo.train INFO: CMC curve, Rank-5  :79.8%
2025-12-10 15:40:44,442 DeMo.train INFO: CMC curve, Rank-10 :86.0%
2025-12-10 15:40:44,442 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:40:45,500 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:40:45,501 DeMo.train INFO: Current is the moe feature testing!
2025-12-10 15:40:45,501 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:40:51,441 DeMo.train INFO: Validation Results - Epoch: 8
2025-12-10 15:40:51,441 DeMo.train INFO: mAP: 69.9%
2025-12-10 15:40:51,441 DeMo.train INFO: CMC curve, Rank-1  :71.3%
2025-12-10 15:40:51,441 DeMo.train INFO: CMC curve, Rank-5  :79.8%
2025-12-10 15:40:51,441 DeMo.train INFO: CMC curve, Rank-10 :86.0%
2025-12-10 15:40:51,441 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:40:52,489 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:40:52,489 DeMo.train INFO: Current is the [moe,ori] feature testing!
2025-12-10 15:40:52,489 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:40:58,414 DeMo.train INFO: Validation Results - Epoch: 8
2025-12-10 15:40:58,414 DeMo.train INFO: mAP: 69.9%
2025-12-10 15:40:58,414 DeMo.train INFO: CMC curve, Rank-1  :71.3%
2025-12-10 15:40:58,414 DeMo.train INFO: CMC curve, Rank-5  :79.8%
2025-12-10 15:40:58,415 DeMo.train INFO: CMC curve, Rank-10 :86.0%
2025-12-10 15:40:58,415 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:40:59,845 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:40:59,846 DeMo.train INFO: Best mAP: 69.9%
2025-12-10 15:40:59,846 DeMo.train INFO: Best Rank-1: 71.3%
2025-12-10 15:40:59,846 DeMo.train INFO: Best Rank-5: 79.8%
2025-12-10 15:40:59,846 DeMo.train INFO: Best Rank-10: 86.0%
2025-12-10 15:40:59,846 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:41:04,567 DeMo.train INFO: Epoch[9] Iteration[10/54] Loss: 2.636, Acc: 0.798, Base Lr: 5.00e-06
2025-12-10 15:41:07,178 DeMo.train INFO: Epoch[9] Iteration[20/54] Loss: 2.627, Acc: 0.824, Base Lr: 5.00e-06
2025-12-10 15:41:09,767 DeMo.train INFO: Epoch[9] Iteration[30/54] Loss: 2.604, Acc: 0.828, Base Lr: 5.00e-06
2025-12-10 15:41:12,473 DeMo.train INFO: Epoch[9] Iteration[40/54] Loss: 2.579, Acc: 0.842, Base Lr: 5.00e-06
2025-12-10 15:41:15,074 DeMo.train INFO: Epoch[9] Iteration[50/54] Loss: 2.583, Acc: 0.835, Base Lr: 5.00e-06
2025-12-10 15:41:15,998 DeMo.train INFO: Epoch 9 done. Time per batch: 0.305[s] Speed: 210.0[samples/s]
2025-12-10 15:41:15,999 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:41:15,999 DeMo.train INFO: Current is the ori feature testing!
2025-12-10 15:41:15,999 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
