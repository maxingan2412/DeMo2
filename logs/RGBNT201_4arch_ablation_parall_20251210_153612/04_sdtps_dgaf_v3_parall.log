2025-12-10 15:36:15,816 DeMo INFO: Saving model in the path :..
2025-12-10 15:36:15,816 DeMo INFO: Namespace(config_file='configs/RGBNT201/DeMo_SDTPS_DGAF_ablation.yml', exp_name=None, fea_cft=0, local_rank=0, opts=['MODEL.USE_SDTPS', 'True', 'MODEL.USE_DGAF', 'True', 'MODEL.DGAF_VERSION', 'v3', 'MODEL.GLOBAL_LOCAL', 'False', 'MODEL.SDTPS_CROSS_ATTN_TYPE', 'attention', 'MODEL.SDTPS_CROSS_ATTN_HEADS', '4'])
2025-12-10 15:36:15,816 DeMo INFO: Loaded configuration file configs/RGBNT201/DeMo_SDTPS_DGAF_ablation.yml
2025-12-10 15:36:15,817 DeMo INFO: 
MODEL:
  TRANSFORMER_TYPE: 'ViT-B-16'
  STRIDE_SIZE: [ 16, 16 ]
  SIE_CAMERA: True
  DIRECT: 1
  SIE_COE: 1.0
  ID_LOSS_WEIGHT: 0.25
  TRIPLET_LOSS_WEIGHT: 1.0
  GLOBAL_LOCAL: False  # DGAF V3 直接用 tokens，不需要 GLOBAL_LOCAL
  # Disable HDM and ATM
  HDM: False
  ATM: False
  # SACR disabled for ablation
  USE_SACR: False
  USE_MULTIMODAL_SACR: False
  # LIF disabled
  USE_LIF: False
  # SDTPS configuration
  USE_SDTPS: True
  SDTPS_SPARSE_RATIO: 0.7  # token 保留比例（70%）
  SDTPS_USE_GUMBEL: False  # 禁用 Gumbel（训练稳定性）
  SDTPS_GUMBEL_TAU: 5.0
  SDTPS_CROSS_ATTN_TYPE: 'attention'  # 使用 Cross-Attention（推荐）
  SDTPS_CROSS_ATTN_HEADS: 4  # Cross-Attention 头数
  # 已废弃参数（保留兼容性）
  SDTPS_BETA: 0.25         # 已不使用（原 MLP predictor 权重）
  SDTPS_AGGR_RATIO: 0.5    # 已不使用（原 TokenAggregation）
  SDTPS_LOSS_WEIGHT: 2.0   # SDTPS 分支的损失权重
  # DGAF: Dual-Gated Adaptive Fusion
  USE_DGAF: True
  DGAF_VERSION: 'v3'  # V3 接受 (B,N,C) tokens
  DGAF_TAU: 1.0
  DGAF_INIT_ALPHA: 0.5
  DGAF_NUM_HEADS: 8
  HEAD: 4

INPUT:
  SIZE_TRAIN: [ 256, 128 ]
  SIZE_TEST: [ 256, 128 ]
  PROB: 0.5
  RE_PROB: 0.5
  PADDING: 10

DATALOADER:
  SAMPLER: 'softmax_triplet'
  NUM_INSTANCE: 8
  NUM_WORKERS: 14

DATASETS:
  NAMES: ('RGBNT201')
  ROOT_DIR: '..'

SOLVER:
  BASE_LR: 0.000005
  LR_SCHEDULER: 'linear'
  MAX_EPOCHS: 50
  STEPS: [30, 40]
  GAMMA: 0.1
  WARMUP_ITERS: 0
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: 'linear'
  OPTIMIZER_NAME: 'Adam'
  IMS_PER_BATCH: 64
  EVAL_PERIOD: 1
  CHECKPOINT_PERIOD: 10

TEST:
  IMS_PER_BATCH: 128
  RE_RANKING: 'no'
  WEIGHT: ''
  NECK_FEAT: 'before'
  FEAT_NORM: 'yes'
  MISS: "nothing"

OUTPUT_DIR: '..'

# ============================================================================
# SDTPS + DGAF Ablation Config
# ============================================================================
# - SACR: disabled
# - SDTPS: configurable via command line
# - DGAF V3: configurable via command line
# - Training: lr=0.00035, epochs=50, warmup=10
# - TF32: enabled in train_net.py
# ============================================================================

2025-12-10 15:36:15,817 DeMo INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 8
  NUM_WORKERS: 14
  SAMPLER: softmax_triplet
DATASETS:
  NAMES: RGBNT201
  ROOT_DIR: ..
INPUT:
  PADDING: 10
  PIXEL_MEAN: [0.5, 0.5, 0.5]
  PIXEL_STD: [0.5, 0.5, 0.5]
  PROB: 0.5
  RE_PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
MODEL:
  ADAPTER: False
  ATM: False
  ATT_DROP_RATE: 0.0
  DEVICE: cuda
  DEVICE_ID: 0
  DGAF_INIT_ALPHA: 0.5
  DGAF_NUM_HEADS: 8
  DGAF_TAU: 1.0
  DGAF_VERSION: v3
  DIRECT: 1
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FROZEN: False
  GLOBAL_LOCAL: False
  HDM: False
  HEAD: 4
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 0.25
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LIF_BETA: 0.4
  LIF_LAYER: 3
  LIF_LOSS_WEIGHT: 0.1
  METRIC_LOSS_TYPE: triplet
  MULTIMODAL_SACR_VERSION: v1
  NAME: DeMo
  NECK: bnneck
  NO_MARGIN: True
  PRETRAIN_PATH_T: /path/to/your/vitb_16_224_21k.pth
  PROMPT: False
  SACR_DILATION_RATES: [2, 3, 4]
  SDTPS_AGGR_RATIO: 0.5
  SDTPS_BETA: 0.25
  SDTPS_CROSS_ATTN_HEADS: 4
  SDTPS_CROSS_ATTN_TYPE: attention
  SDTPS_GUMBEL_TAU: 5.0
  SDTPS_LOSS_WEIGHT: 2.0
  SDTPS_SPARSE_RATIO: 0.7
  SDTPS_USE_GUMBEL: False
  SIE_CAMERA: True
  SIE_COE: 1.0
  SIE_VIEW: False
  STRIDE_SIZE: [16, 16]
  TRANSFORMER_TYPE: ViT-B-16
  TRIPLET_LOSS_WEIGHT: 1.0
  USE_DGAF: True
  USE_LIF: False
  USE_MULTIMODAL_SACR: False
  USE_SACR: False
  USE_SDTPS: True
OUTPUT_DIR: ..
SOLVER:
  BASE_LR: 5e-06
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.1
  IMS_PER_BATCH: 64
  LARGE_FC_LR: False
  LOG_PERIOD: 10
  LR_SCHEDULER: linear
  MARGIN: 0.3
  MAX_EPOCHS: 50
  MOMENTUM: 0.9
  OPTIMIZER_NAME: Adam
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (30, 40)
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 0
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
TEST:
  FEAT: 0
  FEAT_NORM: yes
  IMS_PER_BATCH: 128
  MISS: nothing
  NECK_FEAT: before
  RE_RANKING: no
  WEIGHT: 
=> RGBNT201 loaded
Dataset statistics:
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train    |   171 |     3951 |         4
  query    |    30 |      836 |         2
  gallery  |    30 |      836 |         2
  ----------------------------------------
data is ready
using Transformer_type: ViT-B-16 as a backbone
Resized position embedding: %s to %s torch.Size([197, 768]) torch.Size([129, 768])
Position embedding resize to height:16 width: 8
Successfully load ckpt!
<All keys matched successfully>
Loading pretrained model from CLIP
camera number is : 4
===========Building DeMo===========
2025-12-10 15:36:27,604 DeMo INFO: DeMo(
  (BACKBONE): build_transformer(
    (base): VisionTransformer(
      (conv1): Conv2d(3, 768, kernel_size=(16, 16), stride=(16, 16), bias=False)
      (ln_pre): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
      (transformer): Transformer(
        (resblocks): Sequential(
          (0): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (1): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (2): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (3): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (4): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (5): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (6): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (7): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (8): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (9): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (10): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
          (11): ResidualAttentionBlock(
            (attn): MultiheadAttention(
              (out_proj): NonDynamicallyQuantizableLinear(in_features=768, out_features=768, bias=True)
            )
            (ln_1): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
            (mlp): Sequential(
              (c_fc): Linear(in_features=768, out_features=3072, bias=True)
              (gelu): QuickGELU()
              (c_proj): Linear(in_features=3072, out_features=768, bias=True)
            )
            (ln_2): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
          )
        )
      )
      (ln_post): LayerNorm((768,), eps=1e-05, elementwise_affine=True)
    )
  )
  (pool): AdaptiveAvgPool1d(output_size=1)
  (rgb_reduce): Sequential(
    (0): LayerNorm((1024,), eps=1e-05, elementwise_affine=True)
    (1): Linear(in_features=1024, out_features=512, bias=True)
    (2): QuickGELU()
  )
  (nir_reduce): Sequential(
    (0): LayerNorm((1024,), eps=1e-05, elementwise_affine=True)
    (1): Linear(in_features=1024, out_features=512, bias=True)
    (2): QuickGELU()
  )
  (tir_reduce): Sequential(
    (0): LayerNorm((1024,), eps=1e-05, elementwise_affine=True)
    (1): Linear(in_features=1024, out_features=512, bias=True)
    (2): QuickGELU()
  )
  (sdtps): MultiModalSDTPS(
    (rgb_sparse): TokenSparse(
      (modal_weight_mlp): Sequential(
        (0): Linear(in_features=1536, out_features=256, bias=True)
        (1): LayerNorm((256,), eps=1e-05, elementwise_affine=True)
        (2): GELU(approximate='none')
        (3): Dropout(p=0.1, inplace=False)
        (4): Linear(in_features=256, out_features=64, bias=True)
        (5): GELU(approximate='none')
        (6): Linear(in_features=64, out_features=3, bias=True)
      )
    )
    (nir_sparse): TokenSparse(
      (modal_weight_mlp): Sequential(
        (0): Linear(in_features=1536, out_features=256, bias=True)
        (1): LayerNorm((256,), eps=1e-05, elementwise_affine=True)
        (2): GELU(approximate='none')
        (3): Dropout(p=0.1, inplace=False)
        (4): Linear(in_features=256, out_features=64, bias=True)
        (5): GELU(approximate='none')
        (6): Linear(in_features=64, out_features=3, bias=True)
      )
    )
    (tir_sparse): TokenSparse(
      (modal_weight_mlp): Sequential(
        (0): Linear(in_features=1536, out_features=256, bias=True)
        (1): LayerNorm((256,), eps=1e-05, elementwise_affine=True)
        (2): GELU(approximate='none')
        (3): Dropout(p=0.1, inplace=False)
        (4): Linear(in_features=256, out_features=64, bias=True)
        (5): GELU(approximate='none')
        (6): Linear(in_features=64, out_features=3, bias=True)
      )
    )
    (rgb_self_attn): CrossModalAttention(
      (q_proj): Linear(in_features=512, out_features=512, bias=True)
      (k_proj): Linear(in_features=512, out_features=512, bias=True)
      (attn_drop): Dropout(p=0.0, inplace=False)
    )
    (rgb_cross_nir): CrossModalAttention(
      (q_proj): Linear(in_features=512, out_features=512, bias=True)
      (k_proj): Linear(in_features=512, out_features=512, bias=True)
      (attn_drop): Dropout(p=0.0, inplace=False)
    )
    (rgb_cross_tir): CrossModalAttention(
      (q_proj): Linear(in_features=512, out_features=512, bias=True)
      (k_proj): Linear(in_features=512, out_features=512, bias=True)
      (attn_drop): Dropout(p=0.0, inplace=False)
    )
    (nir_self_attn): CrossModalAttention(
      (q_proj): Linear(in_features=512, out_features=512, bias=True)
      (k_proj): Linear(in_features=512, out_features=512, bias=True)
      (attn_drop): Dropout(p=0.0, inplace=False)
    )
    (nir_cross_rgb): CrossModalAttention(
      (q_proj): Linear(in_features=512, out_features=512, bias=True)
      (k_proj): Linear(in_features=512, out_features=512, bias=True)
      (attn_drop): Dropout(p=0.0, inplace=False)
    )
    (nir_cross_tir): CrossModalAttention(
      (q_proj): Linear(in_features=512, out_features=512, bias=True)
      (k_proj): Linear(in_features=512, out_features=512, bias=True)
      (attn_drop): Dropout(p=0.0, inplace=False)
    )
    (tir_self_attn): CrossModalAttention(
      (q_proj): Linear(in_features=512, out_features=512, bias=True)
      (k_proj): Linear(in_features=512, out_features=512, bias=True)
      (attn_drop): Dropout(p=0.0, inplace=False)
    )
    (tir_cross_rgb): CrossModalAttention(
      (q_proj): Linear(in_features=512, out_features=512, bias=True)
      (k_proj): Linear(in_features=512, out_features=512, bias=True)
      (attn_drop): Dropout(p=0.0, inplace=False)
    )
    (tir_cross_nir): CrossModalAttention(
      (q_proj): Linear(in_features=512, out_features=512, bias=True)
      (k_proj): Linear(in_features=512, out_features=512, bias=True)
      (attn_drop): Dropout(p=0.0, inplace=False)
    )
  )
  (classifier_sdtps): Linear(in_features=1536, out_features=171, bias=False)
  (bottleneck_sdtps): BatchNorm1d(1536, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
  (dgaf): DualGatedAdaptiveFusionV3(
    (attn_pool): MultiheadAttention(
      (out_proj): NonDynamicallyQuantizableLinear(in_features=512, out_features=512, bias=True)
    )
    (attn_norm): LayerNorm((512,), eps=1e-05, elementwise_affine=True)
    (entropy_proj): Linear(in_features=512, out_features=512, bias=True)
    (gate_net): Sequential(
      (0): Linear(in_features=1536, out_features=512, bias=True)
      (1): LayerNorm((512,), eps=1e-05, elementwise_affine=True)
      (2): ReLU(inplace=True)
      (3): Linear(in_features=512, out_features=3, bias=True)
      (4): Sigmoid()
    )
    (modal_enhance): Sequential(
      (0): Linear(in_features=512, out_features=512, bias=True)
      (1): LayerNorm((512,), eps=1e-05, elementwise_affine=True)
    )
  )
  (classifier_dgaf): Linear(in_features=1536, out_features=171, bias=False)
  (bottleneck_dgaf): BatchNorm1d(1536, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
  (classifier): Linear(in_features=1536, out_features=171, bias=False)
  (bottleneck): BatchNorm1d(1536, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
)
2025-12-10 15:36:27,605 DeMo INFO: number of parameters:96.845325
/home/yij/miniconda3/envs/DeMo/lib/python3.8/site-packages/timm/models/helpers.py:7: FutureWarning: Importing from timm.models.helpers is deprecated, please import via timm.models
  warnings.warn(f"Importing from {__name__} is deprecated, please import via timm.models", FutureWarning)
/home/yij/miniconda3/envs/DeMo/lib/python3.8/site-packages/timm/models/registry.py:4: FutureWarning: Importing from timm.models.registry is deprecated, please import via timm.models
  warnings.warn(f"Importing from {__name__} is deprecated, please import via timm.models", FutureWarning)
/home/yij/miniconda3/envs/DeMo/lib/python3.8/site-packages/timm/models/layers/__init__.py:48: FutureWarning: Importing from timm.models.layers is deprecated, please import via timm.layers
  warnings.warn(f"Importing from {__name__} is deprecated, please import via timm.layers", FutureWarning)
/raid/yij/icme/demo2new/DeMo2/modeling/clip/clip.py:23: UserWarning: PyTorch version 1.7.1 or higher is recommended
  warnings.warn("PyTorch version 1.7.1 or higher is recommended")
/home/yij/miniconda3/envs/DeMo/lib/python3.8/site-packages/torchvision/transforms/transforms.py:329: UserWarning: Argument 'interpolation' of type int is deprecated since 0.13 and will be removed in 0.15. Please use InterpolationMode enum.
  warnings.warn(
Unsupported operator aten::std encountered 9 time(s)
Unsupported operator aten::quantile encountered 3 time(s)
Unsupported operator aten::log encountered 3 time(s)
The following submodules of the model were never called during the trace of the graph. They may be unused, or they were accessed by direct calls to .forward() or via other python methods. In the latter case they will have zeros for statistics, though their statistics will still contribute to their parent calling module.
BACKBONE.base.transformer.resblocks.0.attn.out_proj, BACKBONE.base.transformer.resblocks.1.attn.out_proj, BACKBONE.base.transformer.resblocks.10.attn.out_proj, BACKBONE.base.transformer.resblocks.11.attn.out_proj, BACKBONE.base.transformer.resblocks.2.attn.out_proj, BACKBONE.base.transformer.resblocks.3.attn.out_proj, BACKBONE.base.transformer.resblocks.4.attn.out_proj, BACKBONE.base.transformer.resblocks.5.attn.out_proj, BACKBONE.base.transformer.resblocks.6.attn.out_proj, BACKBONE.base.transformer.resblocks.7.attn.out_proj, BACKBONE.base.transformer.resblocks.8.attn.out_proj, BACKBONE.base.transformer.resblocks.9.attn.out_proj, bottleneck, bottleneck_dgaf, bottleneck_sdtps, classifier, classifier_dgaf, classifier_sdtps, dgaf.attn_pool.out_proj, nir_reduce, nir_reduce.0, nir_reduce.1, nir_reduce.2, pool, rgb_reduce, rgb_reduce.0, rgb_reduce.1, rgb_reduce.2, tir_reduce, tir_reduce.0, tir_reduce.1, tir_reduce.2
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Note: out_proj is calculated in MultiheadAttention.forward(), ignore it
Note: bottleneck/classifier not used in inference, ignore it
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:36:30,629 DeMo INFO: number of GFLOPs: 34.788713325999986
using soft triplet loss for training
label smooth on, numclasses: 171
2025-12-10 15:36:30,649 DeMo INFO: TensorBoard logging to: logs/tensorboard/DeMo_SDTPS_DGAF_ablation_20251210_153630
2025-12-10 15:36:30,649 DeMo INFO: Start TensorBoard with: tensorboard --logdir logs/tensorboard --port 6006
2025-12-10 15:36:30,650 DeMo.train INFO: start training
/home/yij/miniconda3/envs/DeMo/lib/python3.8/site-packages/torch/optim/lr_scheduler.py:138: UserWarning: Detected call of `lr_scheduler.step()` before `optimizer.step()`. In PyTorch 1.1.0 and later, you should call them in the opposite order: `optimizer.step()` before `lr_scheduler.step()`.  Failure to do this will result in PyTorch skipping the first value of the learning rate schedule. See more details at https://pytorch.org/docs/stable/optim.html#how-to-adjust-learning-rate
  warnings.warn("Detected call of `lr_scheduler.step()` before `optimizer.step()`. "
/home/yij/miniconda3/envs/DeMo/lib/python3.8/site-packages/torch/optim/lr_scheduler.py:163: UserWarning: The epoch parameter in `scheduler.step()` was not necessary and is being deprecated where possible. Please use `scheduler.step()` to step the scheduler. During the deprecation, if epoch is different from None, the closed form is used instead of the new chainable form, where available. Please open an issue if you are unable to replicate your use case: https://github.com/pytorch/pytorch/issues/new/choose.
  warnings.warn(EPOCH_DEPRECATION_WARNING, UserWarning)
2025-12-10 15:36:35,230 DeMo.train INFO: Epoch[1] Iteration[10/54] Loss: 9.120, Acc: 0.008, Base Lr: 5.00e-06
2025-12-10 15:36:38,234 DeMo.train INFO: Epoch[1] Iteration[20/54] Loss: 7.144, Acc: 0.007, Base Lr: 5.00e-06
2025-12-10 15:36:40,886 DeMo.train INFO: Epoch[1] Iteration[30/54] Loss: 6.290, Acc: 0.008, Base Lr: 5.00e-06
2025-12-10 15:36:43,545 DeMo.train INFO: Epoch[1] Iteration[40/54] Loss: 5.742, Acc: 0.008, Base Lr: 5.00e-06
2025-12-10 15:36:46,209 DeMo.train INFO: Epoch[1] Iteration[50/54] Loss: 5.411, Acc: 0.007, Base Lr: 5.00e-06
2025-12-10 15:36:47,180 DeMo.train INFO: Epoch 1 done. Time per batch: 0.312[s] Speed: 205.4[samples/s]
2025-12-10 15:36:47,181 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:36:47,182 DeMo.train INFO: Current is the ori feature testing!
2025-12-10 15:36:47,182 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:36:52,877 DeMo.train INFO: Validation Results - Epoch: 1
2025-12-10 15:36:52,877 DeMo.train INFO: mAP: 19.9%
2025-12-10 15:36:52,877 DeMo.train INFO: CMC curve, Rank-1  :18.7%
2025-12-10 15:36:52,877 DeMo.train INFO: CMC curve, Rank-5  :35.3%
2025-12-10 15:36:52,877 DeMo.train INFO: CMC curve, Rank-10 :46.2%
2025-12-10 15:36:52,877 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:36:52,879 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:36:52,879 DeMo.train INFO: Current is the moe feature testing!
2025-12-10 15:36:52,879 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:36:57,943 DeMo.train INFO: Validation Results - Epoch: 1
2025-12-10 15:36:57,943 DeMo.train INFO: mAP: 19.9%
2025-12-10 15:36:57,944 DeMo.train INFO: CMC curve, Rank-1  :18.7%
2025-12-10 15:36:57,944 DeMo.train INFO: CMC curve, Rank-5  :35.3%
2025-12-10 15:36:57,944 DeMo.train INFO: CMC curve, Rank-10 :46.2%
2025-12-10 15:36:57,944 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:36:58,710 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:36:58,710 DeMo.train INFO: Current is the [moe,ori] feature testing!
2025-12-10 15:36:58,710 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:37:04,618 DeMo.train INFO: Validation Results - Epoch: 1
2025-12-10 15:37:04,618 DeMo.train INFO: mAP: 19.9%
2025-12-10 15:37:04,618 DeMo.train INFO: CMC curve, Rank-1  :18.7%
2025-12-10 15:37:04,618 DeMo.train INFO: CMC curve, Rank-5  :35.3%
2025-12-10 15:37:04,618 DeMo.train INFO: CMC curve, Rank-10 :46.2%
2025-12-10 15:37:04,618 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:37:05,226 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:37:05,227 DeMo.train INFO: Best mAP: 19.9%
2025-12-10 15:37:05,227 DeMo.train INFO: Best Rank-1: 18.7%
2025-12-10 15:37:05,227 DeMo.train INFO: Best Rank-5: 35.3%
2025-12-10 15:37:05,227 DeMo.train INFO: Best Rank-10: 46.2%
2025-12-10 15:37:05,227 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:37:09,450 DeMo.train INFO: Epoch[2] Iteration[10/54] Loss: 3.684, Acc: 0.039, Base Lr: 5.00e-06
2025-12-10 15:37:12,581 DeMo.train INFO: Epoch[2] Iteration[20/54] Loss: 3.643, Acc: 0.048, Base Lr: 5.00e-06
2025-12-10 15:37:15,273 DeMo.train INFO: Epoch[2] Iteration[30/54] Loss: 3.600, Acc: 0.056, Base Lr: 5.00e-06
2025-12-10 15:37:17,947 DeMo.train INFO: Epoch[2] Iteration[40/54] Loss: 3.553, Acc: 0.062, Base Lr: 5.00e-06
2025-12-10 15:37:20,609 DeMo.train INFO: Epoch[2] Iteration[50/54] Loss: 3.501, Acc: 0.063, Base Lr: 5.00e-06
2025-12-10 15:37:21,579 DeMo.train INFO: Epoch 2 done. Time per batch: 0.309[s] Speed: 207.4[samples/s]
2025-12-10 15:37:21,580 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:37:21,581 DeMo.train INFO: Current is the ori feature testing!
2025-12-10 15:37:21,581 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:37:27,275 DeMo.train INFO: Validation Results - Epoch: 2
2025-12-10 15:37:27,275 DeMo.train INFO: mAP: 46.4%
2025-12-10 15:37:27,275 DeMo.train INFO: CMC curve, Rank-1  :50.4%
2025-12-10 15:37:27,275 DeMo.train INFO: CMC curve, Rank-5  :67.9%
2025-12-10 15:37:27,276 DeMo.train INFO: CMC curve, Rank-10 :76.2%
2025-12-10 15:37:27,276 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:37:27,373 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:37:27,373 DeMo.train INFO: Current is the moe feature testing!
2025-12-10 15:37:27,373 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:37:32,623 DeMo.train INFO: Validation Results - Epoch: 2
2025-12-10 15:37:32,623 DeMo.train INFO: mAP: 46.4%
2025-12-10 15:37:32,624 DeMo.train INFO: CMC curve, Rank-1  :50.4%
2025-12-10 15:37:32,624 DeMo.train INFO: CMC curve, Rank-5  :67.9%
2025-12-10 15:37:32,624 DeMo.train INFO: CMC curve, Rank-10 :76.2%
2025-12-10 15:37:32,624 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:37:33,021 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:37:33,021 DeMo.train INFO: Current is the [moe,ori] feature testing!
2025-12-10 15:37:33,021 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:37:39,011 DeMo.train INFO: Validation Results - Epoch: 2
2025-12-10 15:37:39,011 DeMo.train INFO: mAP: 46.4%
2025-12-10 15:37:39,011 DeMo.train INFO: CMC curve, Rank-1  :50.4%
2025-12-10 15:37:39,011 DeMo.train INFO: CMC curve, Rank-5  :67.9%
2025-12-10 15:37:39,011 DeMo.train INFO: CMC curve, Rank-10 :76.2%
2025-12-10 15:37:39,012 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:37:39,536 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:37:39,537 DeMo.train INFO: Best mAP: 46.4%
2025-12-10 15:37:39,537 DeMo.train INFO: Best Rank-1: 50.4%
2025-12-10 15:37:39,537 DeMo.train INFO: Best Rank-5: 67.9%
2025-12-10 15:37:39,537 DeMo.train INFO: Best Rank-10: 76.2%
2025-12-10 15:37:39,537 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:37:43,693 DeMo.train INFO: Epoch[3] Iteration[10/54] Loss: 3.084, Acc: 0.180, Base Lr: 5.00e-06
2025-12-10 15:37:46,392 DeMo.train INFO: Epoch[3] Iteration[20/54] Loss: 3.156, Acc: 0.189, Base Lr: 5.00e-06
2025-12-10 15:37:49,082 DeMo.train INFO: Epoch[3] Iteration[30/54] Loss: 3.144, Acc: 0.197, Base Lr: 5.00e-06
2025-12-10 15:37:51,761 DeMo.train INFO: Epoch[3] Iteration[40/54] Loss: 3.124, Acc: 0.200, Base Lr: 5.00e-06
2025-12-10 15:37:54,485 DeMo.train INFO: Epoch[3] Iteration[50/54] Loss: 3.139, Acc: 0.214, Base Lr: 5.00e-06
2025-12-10 15:37:55,429 DeMo.train INFO: Epoch 3 done. Time per batch: 0.300[s] Speed: 213.4[samples/s]
2025-12-10 15:37:55,431 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:37:55,431 DeMo.train INFO: Current is the ori feature testing!
2025-12-10 15:37:55,431 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:38:01,167 DeMo.train INFO: Validation Results - Epoch: 3
2025-12-10 15:38:01,167 DeMo.train INFO: mAP: 55.0%
2025-12-10 15:38:01,167 DeMo.train INFO: CMC curve, Rank-1  :57.8%
2025-12-10 15:38:01,167 DeMo.train INFO: CMC curve, Rank-5  :73.6%
2025-12-10 15:38:01,167 DeMo.train INFO: CMC curve, Rank-10 :80.0%
2025-12-10 15:38:01,167 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:38:01,236 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:38:01,237 DeMo.train INFO: Current is the moe feature testing!
2025-12-10 15:38:01,237 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:38:06,069 DeMo.train INFO: Validation Results - Epoch: 3
2025-12-10 15:38:06,070 DeMo.train INFO: mAP: 55.0%
2025-12-10 15:38:06,070 DeMo.train INFO: CMC curve, Rank-1  :57.8%
2025-12-10 15:38:06,070 DeMo.train INFO: CMC curve, Rank-5  :73.6%
2025-12-10 15:38:06,070 DeMo.train INFO: CMC curve, Rank-10 :80.0%
2025-12-10 15:38:06,070 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:38:06,073 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:38:06,073 DeMo.train INFO: Current is the [moe,ori] feature testing!
2025-12-10 15:38:06,073 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:38:11,166 DeMo.train INFO: Validation Results - Epoch: 3
2025-12-10 15:38:11,166 DeMo.train INFO: mAP: 55.0%
2025-12-10 15:38:11,167 DeMo.train INFO: CMC curve, Rank-1  :57.8%
2025-12-10 15:38:11,167 DeMo.train INFO: CMC curve, Rank-5  :73.6%
2025-12-10 15:38:11,167 DeMo.train INFO: CMC curve, Rank-10 :80.0%
2025-12-10 15:38:11,167 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:38:11,633 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:38:11,633 DeMo.train INFO: Best mAP: 55.0%
2025-12-10 15:38:11,633 DeMo.train INFO: Best Rank-1: 57.8%
2025-12-10 15:38:11,634 DeMo.train INFO: Best Rank-5: 73.6%
2025-12-10 15:38:11,634 DeMo.train INFO: Best Rank-10: 80.0%
2025-12-10 15:38:11,634 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:38:15,967 DeMo.train INFO: Epoch[4] Iteration[10/54] Loss: 2.914, Acc: 0.336, Base Lr: 5.00e-06
2025-12-10 15:38:18,818 DeMo.train INFO: Epoch[4] Iteration[20/54] Loss: 2.822, Acc: 0.360, Base Lr: 5.00e-06
2025-12-10 15:38:21,499 DeMo.train INFO: Epoch[4] Iteration[30/54] Loss: 2.851, Acc: 0.360, Base Lr: 5.00e-06
2025-12-10 15:38:24,171 DeMo.train INFO: Epoch[4] Iteration[40/54] Loss: 2.812, Acc: 0.386, Base Lr: 5.00e-06
2025-12-10 15:38:26,848 DeMo.train INFO: Epoch[4] Iteration[50/54] Loss: 2.806, Acc: 0.405, Base Lr: 5.00e-06
2025-12-10 15:38:27,816 DeMo.train INFO: Epoch 4 done. Time per batch: 0.305[s] Speed: 209.6[samples/s]
2025-12-10 15:38:27,817 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:38:27,817 DeMo.train INFO: Current is the ori feature testing!
2025-12-10 15:38:27,817 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:38:33,424 DeMo.train INFO: Validation Results - Epoch: 4
2025-12-10 15:38:33,424 DeMo.train INFO: mAP: 59.4%
2025-12-10 15:38:33,424 DeMo.train INFO: CMC curve, Rank-1  :63.5%
2025-12-10 15:38:33,424 DeMo.train INFO: CMC curve, Rank-5  :77.0%
2025-12-10 15:38:33,424 DeMo.train INFO: CMC curve, Rank-10 :82.5%
2025-12-10 15:38:33,424 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:38:33,539 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:38:33,539 DeMo.train INFO: Current is the moe feature testing!
2025-12-10 15:38:33,539 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:38:38,522 DeMo.train INFO: Validation Results - Epoch: 4
2025-12-10 15:38:38,523 DeMo.train INFO: mAP: 59.4%
2025-12-10 15:38:38,523 DeMo.train INFO: CMC curve, Rank-1  :63.5%
2025-12-10 15:38:38,523 DeMo.train INFO: CMC curve, Rank-5  :77.0%
2025-12-10 15:38:38,523 DeMo.train INFO: CMC curve, Rank-10 :82.5%
2025-12-10 15:38:38,523 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:38:39,274 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:38:39,274 DeMo.train INFO: Current is the [moe,ori] feature testing!
2025-12-10 15:38:39,275 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:38:45,245 DeMo.train INFO: Validation Results - Epoch: 4
2025-12-10 15:38:45,245 DeMo.train INFO: mAP: 59.4%
2025-12-10 15:38:45,246 DeMo.train INFO: CMC curve, Rank-1  :63.5%
2025-12-10 15:38:45,246 DeMo.train INFO: CMC curve, Rank-5  :77.0%
2025-12-10 15:38:45,246 DeMo.train INFO: CMC curve, Rank-10 :82.5%
2025-12-10 15:38:45,246 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:38:45,765 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:38:45,766 DeMo.train INFO: Best mAP: 59.4%
2025-12-10 15:38:45,766 DeMo.train INFO: Best Rank-1: 63.5%
2025-12-10 15:38:45,766 DeMo.train INFO: Best Rank-5: 77.0%
2025-12-10 15:38:45,766 DeMo.train INFO: Best Rank-10: 82.5%
2025-12-10 15:38:45,766 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:38:49,863 DeMo.train INFO: Epoch[5] Iteration[10/54] Loss: 2.677, Acc: 0.588, Base Lr: 5.00e-06
2025-12-10 15:38:53,397 DeMo.train INFO: Epoch[5] Iteration[20/54] Loss: 2.670, Acc: 0.600, Base Lr: 5.00e-06
2025-12-10 15:38:56,120 DeMo.train INFO: Epoch[5] Iteration[30/54] Loss: 2.676, Acc: 0.562, Base Lr: 5.00e-06
2025-12-10 15:38:58,831 DeMo.train INFO: Epoch[5] Iteration[40/54] Loss: 2.661, Acc: 0.557, Base Lr: 5.00e-06
2025-12-10 15:39:01,555 DeMo.train INFO: Epoch[5] Iteration[50/54] Loss: 2.681, Acc: 0.541, Base Lr: 5.00e-06
2025-12-10 15:39:02,505 DeMo.train INFO: Epoch 5 done. Time per batch: 0.316[s] Speed: 202.6[samples/s]
2025-12-10 15:39:02,506 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:39:02,506 DeMo.train INFO: Current is the ori feature testing!
2025-12-10 15:39:02,506 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:39:07,645 DeMo.train INFO: Validation Results - Epoch: 5
2025-12-10 15:39:07,645 DeMo.train INFO: mAP: 61.8%
2025-12-10 15:39:07,646 DeMo.train INFO: CMC curve, Rank-1  :65.0%
2025-12-10 15:39:07,646 DeMo.train INFO: CMC curve, Rank-5  :77.4%
2025-12-10 15:39:07,646 DeMo.train INFO: CMC curve, Rank-10 :85.0%
2025-12-10 15:39:07,646 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:39:08,997 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:39:08,997 DeMo.train INFO: Current is the moe feature testing!
2025-12-10 15:39:08,998 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:39:14,796 DeMo.train INFO: Validation Results - Epoch: 5
2025-12-10 15:39:14,797 DeMo.train INFO: mAP: 61.8%
2025-12-10 15:39:14,797 DeMo.train INFO: CMC curve, Rank-1  :65.0%
2025-12-10 15:39:14,797 DeMo.train INFO: CMC curve, Rank-5  :77.4%
2025-12-10 15:39:14,797 DeMo.train INFO: CMC curve, Rank-10 :85.0%
2025-12-10 15:39:14,797 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:39:14,806 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:39:14,806 DeMo.train INFO: Current is the [moe,ori] feature testing!
2025-12-10 15:39:14,806 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:39:19,728 DeMo.train INFO: Validation Results - Epoch: 5
2025-12-10 15:39:19,729 DeMo.train INFO: mAP: 61.8%
2025-12-10 15:39:19,729 DeMo.train INFO: CMC curve, Rank-1  :65.0%
2025-12-10 15:39:19,729 DeMo.train INFO: CMC curve, Rank-5  :77.4%
2025-12-10 15:39:19,729 DeMo.train INFO: CMC curve, Rank-10 :85.0%
2025-12-10 15:39:19,729 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:39:20,272 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:39:20,272 DeMo.train INFO: Best mAP: 61.8%
2025-12-10 15:39:20,272 DeMo.train INFO: Best Rank-1: 65.0%
2025-12-10 15:39:20,273 DeMo.train INFO: Best Rank-5: 77.4%
2025-12-10 15:39:20,273 DeMo.train INFO: Best Rank-10: 85.0%
2025-12-10 15:39:20,273 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:39:24,254 DeMo.train INFO: Epoch[6] Iteration[10/54] Loss: 2.659, Acc: 0.675, Base Lr: 5.00e-06
2025-12-10 15:39:27,547 DeMo.train INFO: Epoch[6] Iteration[20/54] Loss: 2.694, Acc: 0.655, Base Lr: 5.00e-06
2025-12-10 15:39:30,263 DeMo.train INFO: Epoch[6] Iteration[30/54] Loss: 2.656, Acc: 0.667, Base Lr: 5.00e-06
2025-12-10 15:39:32,965 DeMo.train INFO: Epoch[6] Iteration[40/54] Loss: 2.655, Acc: 0.656, Base Lr: 5.00e-06
2025-12-10 15:39:35,685 DeMo.train INFO: Epoch[6] Iteration[50/54] Loss: 2.661, Acc: 0.665, Base Lr: 5.00e-06
2025-12-10 15:39:36,646 DeMo.train INFO: Epoch 6 done. Time per batch: 0.309[s] Speed: 207.2[samples/s]
2025-12-10 15:39:36,648 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:39:36,648 DeMo.train INFO: Current is the ori feature testing!
2025-12-10 15:39:36,648 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:39:41,808 DeMo.train INFO: Validation Results - Epoch: 6
2025-12-10 15:39:41,808 DeMo.train INFO: mAP: 62.7%
2025-12-10 15:39:41,809 DeMo.train INFO: CMC curve, Rank-1  :65.0%
2025-12-10 15:39:41,809 DeMo.train INFO: CMC curve, Rank-5  :77.6%
2025-12-10 15:39:41,809 DeMo.train INFO: CMC curve, Rank-10 :82.4%
2025-12-10 15:39:41,809 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:39:41,871 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:39:41,872 DeMo.train INFO: Current is the moe feature testing!
2025-12-10 15:39:41,872 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:39:46,876 DeMo.train INFO: Validation Results - Epoch: 6
2025-12-10 15:39:46,876 DeMo.train INFO: mAP: 62.7%
2025-12-10 15:39:46,876 DeMo.train INFO: CMC curve, Rank-1  :65.0%
2025-12-10 15:39:46,876 DeMo.train INFO: CMC curve, Rank-5  :77.6%
2025-12-10 15:39:46,876 DeMo.train INFO: CMC curve, Rank-10 :82.4%
2025-12-10 15:39:46,876 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:39:46,882 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:39:46,882 DeMo.train INFO: Current is the [moe,ori] feature testing!
2025-12-10 15:39:46,882 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:39:52,199 DeMo.train INFO: Validation Results - Epoch: 6
2025-12-10 15:39:52,200 DeMo.train INFO: mAP: 62.7%
2025-12-10 15:39:52,200 DeMo.train INFO: CMC curve, Rank-1  :65.0%
2025-12-10 15:39:52,200 DeMo.train INFO: CMC curve, Rank-5  :77.6%
2025-12-10 15:39:52,200 DeMo.train INFO: CMC curve, Rank-10 :82.4%
2025-12-10 15:39:52,200 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:39:53,650 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:39:53,650 DeMo.train INFO: Best mAP: 62.7%
2025-12-10 15:39:53,650 DeMo.train INFO: Best Rank-1: 65.0%
2025-12-10 15:39:53,650 DeMo.train INFO: Best Rank-5: 77.6%
2025-12-10 15:39:53,650 DeMo.train INFO: Best Rank-10: 82.4%
2025-12-10 15:39:53,650 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:39:58,171 DeMo.train INFO: Epoch[7] Iteration[10/54] Loss: 2.515, Acc: 0.798, Base Lr: 5.00e-06
2025-12-10 15:40:00,879 DeMo.train INFO: Epoch[7] Iteration[20/54] Loss: 2.532, Acc: 0.782, Base Lr: 5.00e-06
2025-12-10 15:40:03,587 DeMo.train INFO: Epoch[7] Iteration[30/54] Loss: 2.558, Acc: 0.753, Base Lr: 5.00e-06
2025-12-10 15:40:06,296 DeMo.train INFO: Epoch[7] Iteration[40/54] Loss: 2.547, Acc: 0.746, Base Lr: 5.00e-06
2025-12-10 15:40:09,001 DeMo.train INFO: Epoch[7] Iteration[50/54] Loss: 2.553, Acc: 0.751, Base Lr: 5.00e-06
2025-12-10 15:40:09,965 DeMo.train INFO: Epoch 7 done. Time per batch: 0.308[s] Speed: 207.9[samples/s]
2025-12-10 15:40:09,966 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:40:09,966 DeMo.train INFO: Current is the ori feature testing!
2025-12-10 15:40:09,966 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:40:15,217 DeMo.train INFO: Validation Results - Epoch: 7
2025-12-10 15:40:15,218 DeMo.train INFO: mAP: 63.1%
2025-12-10 15:40:15,218 DeMo.train INFO: CMC curve, Rank-1  :67.3%
2025-12-10 15:40:15,218 DeMo.train INFO: CMC curve, Rank-5  :78.2%
2025-12-10 15:40:15,218 DeMo.train INFO: CMC curve, Rank-10 :83.3%
2025-12-10 15:40:15,219 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:40:15,605 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:40:15,605 DeMo.train INFO: Current is the moe feature testing!
2025-12-10 15:40:15,605 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:40:21,382 DeMo.train INFO: Validation Results - Epoch: 7
2025-12-10 15:40:21,383 DeMo.train INFO: mAP: 63.1%
2025-12-10 15:40:21,383 DeMo.train INFO: CMC curve, Rank-1  :67.3%
2025-12-10 15:40:21,383 DeMo.train INFO: CMC curve, Rank-5  :78.2%
2025-12-10 15:40:21,383 DeMo.train INFO: CMC curve, Rank-10 :83.3%
2025-12-10 15:40:21,383 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:40:21,387 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:40:21,387 DeMo.train INFO: Current is the [moe,ori] feature testing!
2025-12-10 15:40:21,387 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:40:26,560 DeMo.train INFO: Validation Results - Epoch: 7
2025-12-10 15:40:26,561 DeMo.train INFO: mAP: 63.1%
2025-12-10 15:40:26,561 DeMo.train INFO: CMC curve, Rank-1  :67.3%
2025-12-10 15:40:26,561 DeMo.train INFO: CMC curve, Rank-5  :78.2%
2025-12-10 15:40:26,561 DeMo.train INFO: CMC curve, Rank-10 :83.3%
2025-12-10 15:40:26,561 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:40:27,087 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:40:27,087 DeMo.train INFO: Best mAP: 63.1%
2025-12-10 15:40:27,088 DeMo.train INFO: Best Rank-1: 67.3%
2025-12-10 15:40:27,088 DeMo.train INFO: Best Rank-5: 78.2%
2025-12-10 15:40:27,088 DeMo.train INFO: Best Rank-10: 83.3%
2025-12-10 15:40:27,088 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:40:31,148 DeMo.train INFO: Epoch[8] Iteration[10/54] Loss: 2.467, Acc: 0.764, Base Lr: 5.00e-06
2025-12-10 15:40:33,877 DeMo.train INFO: Epoch[8] Iteration[20/54] Loss: 2.490, Acc: 0.777, Base Lr: 5.00e-06
2025-12-10 15:40:36,590 DeMo.train INFO: Epoch[8] Iteration[30/54] Loss: 2.484, Acc: 0.782, Base Lr: 5.00e-06
2025-12-10 15:40:39,293 DeMo.train INFO: Epoch[8] Iteration[40/54] Loss: 2.514, Acc: 0.780, Base Lr: 5.00e-06
2025-12-10 15:40:42,006 DeMo.train INFO: Epoch[8] Iteration[50/54] Loss: 2.508, Acc: 0.786, Base Lr: 5.00e-06
2025-12-10 15:40:42,958 DeMo.train INFO: Epoch 8 done. Time per batch: 0.299[s] Speed: 213.7[samples/s]
2025-12-10 15:40:42,959 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:40:42,959 DeMo.train INFO: Current is the ori feature testing!
2025-12-10 15:40:42,960 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:40:49,118 DeMo.train INFO: Validation Results - Epoch: 8
2025-12-10 15:40:49,119 DeMo.train INFO: mAP: 63.5%
2025-12-10 15:40:49,119 DeMo.train INFO: CMC curve, Rank-1  :66.6%
2025-12-10 15:40:49,119 DeMo.train INFO: CMC curve, Rank-5  :79.2%
2025-12-10 15:40:49,119 DeMo.train INFO: CMC curve, Rank-10 :83.1%
2025-12-10 15:40:49,120 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:40:50,186 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:40:50,186 DeMo.train INFO: Current is the moe feature testing!
2025-12-10 15:40:50,187 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:40:56,610 DeMo.train INFO: Validation Results - Epoch: 8
2025-12-10 15:40:56,611 DeMo.train INFO: mAP: 63.5%
2025-12-10 15:40:56,611 DeMo.train INFO: CMC curve, Rank-1  :66.6%
2025-12-10 15:40:56,611 DeMo.train INFO: CMC curve, Rank-5  :79.2%
2025-12-10 15:40:56,611 DeMo.train INFO: CMC curve, Rank-10 :83.1%
2025-12-10 15:40:56,611 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:40:56,965 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:40:56,965 DeMo.train INFO: Current is the [moe,ori] feature testing!
2025-12-10 15:40:56,965 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The test feature is normalized
=> Computing DistMat with euclidean_distance
2025-12-10 15:41:02,863 DeMo.train INFO: Validation Results - Epoch: 8
2025-12-10 15:41:02,863 DeMo.train INFO: mAP: 63.5%
2025-12-10 15:41:02,863 DeMo.train INFO: CMC curve, Rank-1  :66.6%
2025-12-10 15:41:02,863 DeMo.train INFO: CMC curve, Rank-5  :79.2%
2025-12-10 15:41:02,863 DeMo.train INFO: CMC curve, Rank-10 :83.1%
2025-12-10 15:41:02,863 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:41:03,373 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:41:03,374 DeMo.train INFO: Best mAP: 63.5%
2025-12-10 15:41:03,374 DeMo.train INFO: Best Rank-1: 66.6%
2025-12-10 15:41:03,374 DeMo.train INFO: Best Rank-5: 79.2%
2025-12-10 15:41:03,374 DeMo.train INFO: Best Rank-10: 83.1%
2025-12-10 15:41:03,374 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:41:07,485 DeMo.train INFO: Epoch[9] Iteration[10/54] Loss: 2.549, Acc: 0.755, Base Lr: 5.00e-06
2025-12-10 15:41:10,211 DeMo.train INFO: Epoch[9] Iteration[20/54] Loss: 2.578, Acc: 0.770, Base Lr: 5.00e-06
2025-12-10 15:41:12,925 DeMo.train INFO: Epoch[9] Iteration[30/54] Loss: 2.538, Acc: 0.779, Base Lr: 5.00e-06
2025-12-10 15:41:15,644 DeMo.train INFO: Epoch[9] Iteration[40/54] Loss: 2.516, Acc: 0.808, Base Lr: 5.00e-06
2025-12-10 15:41:18,381 DeMo.train INFO: Epoch[9] Iteration[50/54] Loss: 2.509, Acc: 0.817, Base Lr: 5.00e-06
2025-12-10 15:41:19,312 DeMo.train INFO: Epoch 9 done. Time per batch: 0.301[s] Speed: 212.8[samples/s]
2025-12-10 15:41:19,314 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2025-12-10 15:41:19,314 DeMo.train INFO: Current is the ori feature testing!
2025-12-10 15:41:19,314 DeMo.train INFO: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
