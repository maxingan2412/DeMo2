# SDTPS + DGAF 模块消融实验报告

**实验时间**: 2025-12-07 11:50 - 12:35
**数据集**: RGBNT201
**基础配置**: `configs/RGBNT201/DeMo_MultiModalSACR_SDTPS_DGAF.yml`
**日志位置**: `logs/RGBNT201_ablation_SDTPS_DGAF_20251207_115040/`

---

## 1. 实验设计

完整的 2×2 消融实验，测试 SDTPS 和 DGAF V3 模块的独立贡献和组合效果。

| 实验 | SDTPS | DGAF V3 | 说明 |
|------|-------|---------|------|
| Baseline | ✗ | ✗ | 纯骨干网络 |
| SDTPS only | ✓ | ✗ | 仅 Token Selection |
| DGAF V3 only | ✗ | ✓ | 仅双门控融合 |
| SDTPS + DGAF V3 | ✓ | ✓ | 完整流程 |

---

## 2. 实验结果

| 配置 | SDTPS | DGAF | Params (M) | GFLOPs | mAP (%) | Rank-1 (%) | Rank-10 (%) |
|------|-------|------|------------|--------|---------|------------|-------------|
| Baseline | ✗ | ✗ | 87.99 | 34.28 | 72.8 | 74.6 | 90.3 |
| SDTPS only | ✓ | ✗ | 88.62 | 34.33 | 75.2 | 76.2 | 90.7 |
| DGAF V3 only | ✗ | ✓ | 90.62 | 34.48 | 75.4 | 77.5 | 88.4 |
| **SDTPS + DGAF V3** | ✓ | ✓ | 90.99 | 34.40 | **75.7** | **79.5** | **93.4** |

---

## 3. 模块贡献分析

### 3.1 相比 Baseline 的提升

| 配置 | Δ mAP | Δ Rank-1 | Δ Rank-10 |
|------|-------|----------|-----------|
| + SDTPS | +2.4 | +1.6 | +0.4 |
| + DGAF V3 | +2.6 | +2.9 | -1.9 |
| + SDTPS + DGAF V3 | **+2.9** | **+4.9** | **+3.1** |

### 3.2 模块独立贡献

| 模块 | 额外参数 | 额外 GFLOPs | mAP 贡献 | Rank-1 贡献 |
|------|----------|-------------|----------|-------------|
| SDTPS | +0.63M | +0.05 | +2.4% | +1.6% |
| DGAF V3 | +2.63M | +0.20 | +2.6% | +2.9% |

### 3.3 组合效应

- **SDTPS + DGAF V3** 相比单独使用任一模块均有提升
- Rank-1: 79.5% > 77.5% (DGAF only) > 76.2% (SDTPS only)
- Rank-10: 93.4% 显著优于其他配置，说明组合使用改善了检索的召回率

---

## 4. 关键发现

### 4.1 SDTPS 模块
- **作用**: Token Selection，选择重要的 patch tokens
- **效果**: mAP +2.4%, Rank-1 +1.6%
- **开销**: +0.63M 参数，GFLOPs 几乎不变

### 4.2 DGAF V3 模块
- **作用**: 双门控自适应融合（IEG + MIG）
- **效果**: mAP +2.6%, Rank-1 +2.9%
- **开销**: +2.63M 参数，+0.20 GFLOPs
- **注意**: 单独使用时 Rank-10 下降，但与 SDTPS 组合后显著提升

### 4.3 组合效应
- **1 + 1 > 2**: SDTPS 和 DGAF V3 存在协同效应
- **Rank-10 提升最大**: 组合使用时 Rank-10 达到 93.4%（+3.1%）
- **原因分析**: SDTPS 提供更优质的 token，DGAF V3 进行更有效的融合

---

## 5. 模型规格对比

| 指标 | Baseline | SDTPS only | DGAF V3 only | SDTPS + DGAF V3 |
|------|----------|------------|--------------|-----------------|
| Parameters (M) | 87.99 | 88.62 | 90.62 | 90.99 |
| GFLOPs | 34.28 | 34.33 | 34.48 | 34.40 |
| 相对 Baseline | - | +0.7% | +3.0% | +3.4% |

---

## 6. 结论

1. **两个模块均有效**: SDTPS 和 DGAF V3 单独使用都能提升性能
2. **DGAF V3 单独效果略优于 SDTPS**: mAP +2.6% vs +2.4%
3. **组合使用效果最佳**: mAP 75.7%, Rank-1 79.5%, Rank-10 93.4%
4. **存在协同效应**: 组合提升 > 单独提升之和（尤其是 Rank-10）
5. **计算开销可接受**: 完整配置仅增加 3.0M 参数（+3.4%），GFLOPs 基本不变

---

## 7. 推荐配置

基于消融实验结果，推荐同时启用 SDTPS 和 DGAF V3：

```yaml
MODEL:
  USE_SDTPS: True
  USE_DGAF: True
  DGAF_VERSION: 'v3'
```
